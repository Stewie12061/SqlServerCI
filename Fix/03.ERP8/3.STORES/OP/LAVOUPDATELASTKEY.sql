IF EXISTS (
		SELECT TOP 1 1
		FROM DBO.SYSOBJECTS
		WHERE ID = OBJECT_ID(N'[DBO].[LAVOUPDATELASTKEY]')
			AND OBJECTPROPERTY(ID, N'IsProcedure') = 1
		)
	DROP PROCEDURE [DBO].[LAVOUPDATELASTKEY]
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_NULLS ON
GO

--	LAVOUPDATELASTKEY 'LG',
--- Modified by Tiểu Mai on 30/03/2016: Bổ sung trường Longitude, Latitude
CREATE PROCEDURE LAVOUPDATELASTKEY (
	@DivisionID VARCHAR(50)
	,@KeyString NVARCHAR(50)
	,@LastKey INT
	)
AS
DECLARE @lk INT = - 1;

SELECT @lk = LASTKEY
FROM at4444
WHERE KEYSTRING = @KeyString

IF (@lk = - 1)
BEGIN
	INSERT at4444 (
		DivisionID
		,TABLENAME
		,KEYSTRING
		,LASTKEY
		)
	VALUES (
		@DivisionID
		,'APT0001'
		,@KeyString
		,1
		)
END
ELSE
BEGIN
	UPDATE AT4444
	SET LASTKEY = @LastKey
	WHERE KEYSTRING = @KeyString
END
GO

SET QUOTED_IDENTIFIER OFF
GO

SET ANSI_NULLS ON
GO




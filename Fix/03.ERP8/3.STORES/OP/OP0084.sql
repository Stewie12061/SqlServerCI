IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WITH (NOLOCK) WHERE ID = OBJECT_ID(N'[DBO].[OP0084]') AND OBJECTPROPERTY(ID, N'IsProcedure') = 1)
DROP PROCEDURE [DBO].[OP0084]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

-- <Summary>
---- In so sánh đơn hàng sx (Customize cho An Phát)
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
---- 
-- <History>
---- Created by Tiểu Mai on 06/01/2016
---- Modified by Tiểu Mai on 28/01/2016: Bổ sung 20 cột Tên quy cách UserName01--> UserName20
---- Modified on 31/05/2016 by Bảo Thy: Bổ sung WITH (NOLOCK)
---- Modify on 26/04/2017 by Bảo Anh: Sửa danh mục dùng chung (bỏ kết theo DivisionID)
---- Modified by Huỳnh Thử on 28/09/2020 : Bổ sung danh mục dùng chung
---- Modified by Đức Duy on 13/02/2023: [2023/02/IS/0052] - Bổ sung thêm điều kiện DivisionID dùng chung cho bảng danh mục kho hàng - AT1303.
---- Modified by Đức Duy on 20/02/2023: [2023/02/IS/0091] - Bổ sung thêm điều kiện DivisionID dùng chung cho bảng danh mục đối tượng - AT1202.

-- exec OP0084 'PC', 'SC/02/2016/0001', 'SC/02/2016/0001'
-- select * from OV0084

CREATE PROCEDURE [dbo].[OP0084] 	
				@DivisionID AS NVARCHAR(50),		
				@FromSOrderID AS NVARCHAR(50),
				@ToSOrderID AS NVARCHAR(50)

AS
DECLARE @sSQL AS nvarchar(MAX), @sSQL1 AS nvarchar(MAX)
DECLARE @sSQL2 AS NVARCHAR(MAX), @sSQL3 AS nvarchar(MAX) 
DECLARE @CustomizeName INT
SET @CustomizeName  = (SELECT CustomerName FROM CustomerIndex)

SET @sSQL = ''
SET @sSQL1 = ''
SET @sSQL2 = ''
SET @sSQL3 = ''

IF @CustomizeName = 54
BEGIN
	SET @sSQL = 'SELECT OT2002.DivisionID, OT2001.ObjectID, OT2002.SOrderID, OT2002.TransactionID, OT2002.InventoryID, OT2002.OrderQuantity, 
	O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID,
	M37.TransactionID as MTransactionID, M37.MaterialID, M37.MaterialUnitID, M37.MaterialTypeID, M37.MaterialQuantity, M37.RateDecimalApp, M37.QuantityUnit, M37.MaterialAmount,
	M37.DS01ID, M37.DS02ID, M37.DS03ID, M37.DS04ID, M37.DS05ID, M37.DS06ID, M37.DS07ID, M37.DS08ID, M37.DS09ID, M37.DS10ID,
	M37.DS11ID, M37.DS12ID, M37.DS13ID, M37.DS14ID, M37.DS15ID, M37.DS16ID, M37.DS17ID, M37.DS18ID, M37.DS19ID, M37.DS20ID
	FROM OT2001 WITH (NOLOCK)
	INNER JOIN OT2002 WITH (NOLOCK) ON OT2002.DivisionID = OT2001.DivisionID AND OT2002.SOrderID = OT2001.SOrderID
	LEFT JOIN OT8899 O99 WITH (NOLOCK) ON O99.DivisionID = OT2002.DivisionID AND O99.VoucherID = OT2002.SOrderID AND O99.TransactionID  = OT2002.TransactionID and O99.TableID  = ''OT2002''
	LEFT JOIN MT0136 M36 WITH (NOLOCK) ON M36.DivisionID = OT2002.DivisionID AND M36.ApportionID = OT2002.InheritVoucherID AND M36.TransactionID = OT2002.InheritTransactionID AND
					ISNULL(O99.S01ID,'''') = ISNULL(M36.S01ID,'''') AND 
					ISNULL(O99.S02ID,'''') = ISNULL(M36.S02ID,'''') AND 
					ISNULL(O99.S03ID,'''') = ISNULL(M36.S03ID,'''') AND 
					ISNULL(O99.S04ID,'''') = ISNULL(M36.S04ID,'''') AND 
					ISNULL(O99.S05ID,'''') = ISNULL(M36.S05ID,'''') AND 
					ISNULL(O99.S06ID,'''') = ISNULL(M36.S06ID,'''') AND 
					ISNULL(O99.S07ID,'''') = ISNULL(M36.S07ID,'''') AND 
					ISNULL(O99.S08ID,'''') = ISNULL(M36.S08ID,'''') AND 
					ISNULL(O99.S09ID,'''') = ISNULL(M36.S09ID,'''') AND 
					ISNULL(O99.S10ID,'''') = ISNULL(M36.S10ID,'''') AND 
					ISNULL(O99.S11ID,'''') = ISNULL(M36.S11ID,'''') AND 
					ISNULL(O99.S12ID,'''') = ISNULL(M36.S12ID,'''') AND 
					ISNULL(O99.S13ID,'''') = ISNULL(M36.S13ID,'''') AND 
					ISNULL(O99.S14ID,'''') = ISNULL(M36.S14ID,'''') AND 
					ISNULL(O99.S15ID,'''') = ISNULL(M36.S15ID,'''') AND 
					ISNULL(O99.S16ID,'''') = ISNULL(M36.S16ID,'''') AND 
					ISNULL(O99.S17ID,'''') = ISNULL(M36.S17ID,'''') AND 
					ISNULL(O99.S18ID,'''') = ISNULL(M36.S18ID,'''') AND 
					ISNULL(O99.S19ID,'''') = ISNULL(M36.S19ID,'''') AND 
					ISNULL(O99.S20ID,'''') = ISNULL(M36.S20ID,'''') 
	LEFT JOIN MT0137 M37 WITH (NOLOCK) ON M37.DivisionID = M36.DivisionID AND M37.ProductID = M36.ProductID AND M37.ReTransactionID = M36.TransactionID
	
	WHERE OT2001.DivisionID = '''+ @DivisionID +''' AND 
				OT2001.SOrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+''' AND
				OT2001.OrderType = 0
				AND M37.ExpenseID = ''COST001''	'


	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00841')
		EXEC ('CREATE VIEW OV00841  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00841  ---TAO BOI OP0084
			AS '+@sSQL)
		
	SET @sSQL = '	SELECT DISTINCT	OT2002.DivisionID, OT2001.SOrderID, OT2002.TransactionID, OT2001.VoucherTypeID, OT2001.VoucherNo, OT2001.OrderDate, 
				OT2001.ObjectID, 
				OT2002.InventoryID, InventoryName, AT1302.UnitID, UnitName, 
				OrderQuantity, OT2001.DepartmentID, 
				--InheritedQuantity,
				OT2001.PeriodID, 
				OT2002.Ana01ID, OT2002.Ana02ID, OT2002.Ana03ID, OT2002.Ana04ID, OT2002.Ana05ID, 
				OT1002_1.AnaName AS AnaName1,
				OT1002_2.AnaName AS AnaName2,
				OT1002_3.AnaName AS AnaName3,
				OT1002_4.AnaName AS AnaName4,
				OT1002_5.AnaName AS AnaName5,
				OT2002.nvarchar01,	OT2002.nvarchar02,	OT2002.nvarchar03,	OT2002.nvarchar04,	OT2002.nvarchar05,	
				OT2002.nvarchar06,	OT2002.nvarchar07,	OT2002.nvarchar08,	OT2002.nvarchar09,	OT2002.nvarchar10,
				OT2001.InheritSOrderID,
				AT1302.InventoryTypeID,
				OT2002.InheritVoucherID,
				OT2002.InheritTransactionID,
				OT2002.Description,
				M89.PlanQuantity, 
				O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID, 
				O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID, 
				M37.TransactionID as OTransactionID, M37.MaterialID, M37.MaterialUnitID, M37.MaterialTypeID, M37.MaterialQuantity, M37.QuantityUnit, M37.Rate, M37.RateDecimalApp, M37.RateWastage, M37.MaterialPrice, 
				M37.MaterialAmount, M37.MaterialGroupID, 
				M37.DS01ID, M37.DS02ID, M37.DS03ID, M37.DS04ID, M37.DS05ID, M37.DS06ID, M37.DS07ID, M37.DS08ID, M37.DS09ID, M37.DS10ID, 
				M37.DS11ID, M37.DS12ID, M37.DS13ID, M37.DS14ID, M37.DS15ID, M37.DS16ID, M37.DS17ID, M37.DS18ID, M37.DS19ID, M37.DS20ID	'
		
	SET @sSQL1 = '			
		FROM	OT2002  WITH (NOLOCK)
		LEFT JOIN AT1302 WITH (NOLOCK) ON AT1302.DivisionID IN (''@@@'', OT2002.DivisionID) AND AT1302.InventoryID = OT2002.InventoryID
		LEFT JOIN OT1003 WITH (NOLOCK) ON OT1003.MethodID = OT2002.MethodID  AND OT1003.DivisionID = OT2002.DivisionID
		INNER JOIN OT2001 WITH (NOLOCK) ON OT2001.SOrderID = OT2002.SOrderID AND OT2001.DivisionID = OT2002.DivisionID
		LEFT JOIN OT2001 Inherit_OT2001 WITH (NOLOCK) ON Inherit_OT2001.InheritSOrderID = OT2002.SOrderID AND Inherit_OT2001.DivisionID = OT2002.DivisionID	
		LEFT JOIN AT1303 WITH (NOLOCK) ON AT1303.DivisionID IN (''@@@'', '''+@DivisionID+''') AND AT1303.WareHouseID = OT2002.WareHouseID
		LEFT JOIN AT1102 WITH (NOLOCK) ON AT1102.DepartmentID = OT2001.DepartmentID
		LEFT JOIN AT1301 WITH (NOLOCK) ON AT1301.InventoryTypeID = OT2001.InventoryTypeID
		LEFT JOIN AT1304 WITH (NOLOCK) ON AT1304.UnitID = AT1302.UnitID
		--LEFT JOIN AT1103 ON AT1103.EmployeeID = OT2001.EmployeeID
		--LEFT JOIN AT1103 AT1103_2 on AT1103_2.EmployeeID = OT2001.SalesManID
		LEFT JOIN AT1011 OT1002_1 WITH (NOLOCK) ON OT1002_1.AnaID = OT2002.Ana01ID AND  OT1002_1.AnaTypeID = ''A01''
		LEFT JOIN AT1011 OT1002_2 WITH (NOLOCK) ON OT1002_2.AnaID = OT2002.Ana02ID AND  OT1002_2.AnaTypeID = ''A02''
		LEFT JOIN AT1011 OT1002_3 WITH (NOLOCK) ON OT1002_3.AnaID = OT2002.Ana03ID AND  OT1002_3.AnaTypeID = ''A03''
		LEFT JOIN AT1011 OT1002_4 WITH (NOLOCK) ON OT1002_4.AnaID = OT2002.Ana04ID AND  OT1002_4.AnaTypeID = ''A04''
		LEFT JOIN AT1011 OT1002_5 WITH (NOLOCK) ON OT1002_5.AnaID = OT2002.Ana05ID AND  OT1002_5.AnaTypeID = ''A05''
		LEFT JOIN OT8899 O99 WITH (NOLOCK) ON O99.DivisionID = OT2002.DivisionID AND O99.VoucherID = OT2002.SOrderID AND O99.TransactionID  = OT2002.TransactionID and O99.TableID  = ''OT2002''
		LEFT JOIN MT0136 M36 WITH (NOLOCK) ON M36.DivisionID = OT2001.DivisionID AND M36.ApportionID = OT2001.InheritApportionID  AND M36.ProductID = OT2002.InventoryID AND
						ISNULL(O99.S01ID,'''') = ISNULL(M36.S01ID,'''') AND 
						ISNULL(O99.S02ID,'''') = ISNULL(M36.S02ID,'''') AND 
						ISNULL(O99.S03ID,'''') = ISNULL(M36.S03ID,'''') AND 
						ISNULL(O99.S04ID,'''') = ISNULL(M36.S04ID,'''') AND 
						ISNULL(O99.S05ID,'''') = ISNULL(M36.S05ID,'''') AND 
						ISNULL(O99.S06ID,'''') = ISNULL(M36.S06ID,'''') AND 
						ISNULL(O99.S07ID,'''') = ISNULL(M36.S07ID,'''') AND 
						ISNULL(O99.S08ID,'''') = ISNULL(M36.S08ID,'''') AND 
						ISNULL(O99.S09ID,'''') = ISNULL(M36.S09ID,'''') AND 
						ISNULL(O99.S10ID,'''') = ISNULL(M36.S10ID,'''') AND 
						ISNULL(O99.S11ID,'''') = ISNULL(M36.S11ID,'''') AND 
						ISNULL(O99.S12ID,'''') = ISNULL(M36.S12ID,'''') AND 
						ISNULL(O99.S13ID,'''') = ISNULL(M36.S13ID,'''') AND 
						ISNULL(O99.S14ID,'''') = ISNULL(M36.S14ID,'''') AND 
						ISNULL(O99.S15ID,'''') = ISNULL(M36.S15ID,'''') AND 
						ISNULL(O99.S16ID,'''') = ISNULL(M36.S16ID,'''') AND 
						ISNULL(O99.S17ID,'''') = ISNULL(M36.S17ID,'''') AND 
						ISNULL(O99.S18ID,'''') = ISNULL(M36.S18ID,'''') AND		
						ISNULL(O99.S19ID,'''') = ISNULL(M36.S19ID,'''') AND 
						ISNULL(O99.S20ID,'''') = ISNULL(M36.S20ID,'''') '
		SET @sSQL2 = '				
		LEFT JOIN MT0137 M37 WITH (NOLOCK) ON M37.DivisionID = M36.DivisionID AND M37.ProductID = M36.ProductID AND M37.ReTransactionID = M36.TransactionID
		LEFT JOIN (SELECT M01.DivisionID, M01.PlanID, M01.SOderID, M02.PlanDetailID, M02.InventoryID, M02.PlanQuantity,
						M99.S01ID, M99.S02ID, M99.S03ID, M99.S04ID, M99.S05ID, M99.S06ID, M99.S07ID, M99.S08ID, M99.S09ID, M99.S10ID,
						M99.S11ID, M99.S12ID, M99.S13ID, M99.S14ID, M99.S15ID, M99.S16ID, M99.S17ID, M99.S18ID, M99.S19ID, M99.S20ID
		             FROM MT2001 M01 WITH (NOLOCK) 
		LEFT JOIN MT2002 M02 WITH (NOLOCK) ON M02.DivisionID = M01.DivisionID AND M02.PlanID = M01.PlanID 
		LEFT JOIN MT8899 M99 WITH (NOLOCK) ON M99.DivisionID = M02.DivisionID AND M99.VoucherID = M02.PlanID AND M99.TransactionID = M02.PlanDetailID) AS M89 ON 
						M89.DivisionID = OT2001.DivisionID AND M89.SOderID = OT2001.SOrderID AND M89.InventoryID = OT2002.InventoryID AND
						ISNULL(O99.S01ID,'''') = ISNULL(M89.S01ID,'''') AND 
						ISNULL(O99.S02ID,'''') = ISNULL(M89.S02ID,'''') AND 
						ISNULL(O99.S03ID,'''') = ISNULL(M89.S03ID,'''') AND 
						ISNULL(O99.S04ID,'''') = ISNULL(M89.S04ID,'''') AND 
						ISNULL(O99.S05ID,'''') = ISNULL(M89.S05ID,'''') AND 
						ISNULL(O99.S06ID,'''') = ISNULL(M89.S06ID,'''') AND 
						ISNULL(O99.S07ID,'''') = ISNULL(M89.S07ID,'''') AND 
						ISNULL(O99.S08ID,'''') = ISNULL(M89.S08ID,'''') AND 
						ISNULL(O99.S09ID,'''') = ISNULL(M89.S09ID,'''') AND 
						ISNULL(O99.S10ID,'''') = ISNULL(M89.S10ID,'''') AND 
						ISNULL(O99.S11ID,'''') = ISNULL(M89.S11ID,'''') AND 
						ISNULL(O99.S12ID,'''') = ISNULL(M89.S12ID,'''') AND 
						ISNULL(O99.S13ID,'''') = ISNULL(M89.S13ID,'''') AND 
						ISNULL(O99.S14ID,'''') = ISNULL(M89.S14ID,'''') AND 
						ISNULL(O99.S15ID,'''') = ISNULL(M89.S15ID,'''') AND 
						ISNULL(O99.S16ID,'''') = ISNULL(M89.S16ID,'''') AND 
						ISNULL(O99.S17ID,'''') = ISNULL(M89.S17ID,'''') AND 
						ISNULL(O99.S18ID,'''') = ISNULL(M89.S18ID,'''') AND 
						ISNULL(O99.S19ID,'''') = ISNULL(M89.S19ID,'''') AND 
						ISNULL(O99.S20ID,'''') = ISNULL(M89.S20ID,'''')			
		WHERE	OT2001.DivisionID = '''+ @DivisionID +''' AND 
				OT2001.InheritSOrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+''' AND
				OT2001.OrderType = 1
				AND M37.ExpenseID = ''COST001'''		

	--PRINT @sSQL
	--PRINT @sSQL1
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00842')
		EXEC ('CREATE VIEW OV00842  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2)
	ELSE
		EXEC( 'ALTER VIEW OV00842  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2)

------- Dữ liệu xuất kho NPL
	SET @sSQL = 'SELECT A07.DivisionID, A06.WareHouseID AS ExWareHouseID, A07.DebitAccountID AS ExDebitAccountID, A07.CreditAccountID AS ExCreditAccountID, 
					A07.InventoryID, A07.ActualQuantity AS ExActualQuantity, A07.Ana05ID AS ExAna05ID, W96.MOrderID as SOrderID, W96.OTransactionID,
					O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
					O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
	FROM AT2007 A07 WITH (NOLOCK)
	INNER JOIN AT2006 A06 WITH (NOLOCK) ON A06.DivisionID = A07.DivisionID AND A06.VoucherID = A07.VoucherID
	LEFT JOIN WT0096 W96 WITH (NOLOCK) ON W96.DivisionID = A07.DivisionID AND W96.VoucherID = A07.InheritVoucherID --AND W96.TransactionID = A07.InheritTransactionID 
	AND W96.Ana05ID = A07.Ana05ID AND W96.InventoryID = A07.InventoryID
	LEFT JOIN WT0095 W95 WITH (NOLOCK) ON W95.DivisionID = W96.DivisionID AND W96.VoucherID = W95.VoucherID
	LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = A07.DivisionID AND O99.VoucherID = A07.VoucherID AND O99.TransactionID = A07.TransactionID AND O99.TableID = ''AT2007''
	WHERE W96.DivisionID = '''+ @DivisionID +'''
	AND W95.KindVoucherID IN (2,4,6)
	GROUP BY A07.DivisionID, A06.WareHouseID, A07.DebitAccountID, A07.CreditAccountID, A07.InventoryID, A07.ActualQuantity, A07.Ana05ID, W96.MOrderID, W96.OTransactionID, 
	O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID	'

	--PRINT @sSQL
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00843')
		EXEC ('CREATE VIEW OV00843  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00843  ---TAO BOI OP0084
			AS '+@sSQL)	

------ Dữ liệu nhập kho NPL			
	SET @sSQL = 'SELECT A07.DivisionID, A07.OrderID AS SOrderID, A06.WareHouseID AS ImWareHouseID, A07.DebitAccountID AS ImDebitAccountID, A07.CreditAccountID AS ImCreditAccountID, 
	A07.OTransactionID, A07.InventoryID, A07.ActualQuantity AS ImActualQuantity, A07.Ana05ID AS ImAna05ID,
	O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
FROM AT2007 A07 WITH (NOLOCK)
INNER JOIN AT2006 A06 WITH (NOLOCK) ON A06.DivisionID = A07.DivisionID AND A06.VoucherID = A07.VoucherID
LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = A07.DivisionID AND O99.VoucherID = A07.VoucherID AND O99.TransactionID = A07.TransactionID AND O99.TableID = ''AT2007''
WHERE A07.DivisionID = '''+@DivisionID+'''
	AND A06.KindVoucherID IN (1,3,5)
	AND A07.OrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+'''
GROUP BY A07.DivisionID, A07.OrderID, A06.WareHouseID, A07.DebitAccountID, A07.CreditAccountID, A07.OTransactionID, A07.InventoryID, A07.Ana05ID, A07.ActualQuantity,
O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID	'

	--PRINT @sSQL
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00844')
		EXEC ('CREATE VIEW OV00844  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00844  ---TAO BOI OP0084
			AS '+@sSQL)
	
------ Dữ liệu nhập kho thành phẩm từ KQSX		
	SET @sSQL = 'SELECT A07.DivisionID, O01.SOrderID, A06.WareHouseID AS ImWareHouseID, A07.DebitAccountID AS ImDebitAccountID, A07.CreditAccountID AS ImCreditAccountID, 
	A07.InventoryID, A07.ActualQuantity as ImQuantityProduct, A07.Ana05ID AS ImAna05ID,
	O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
FROM AT2007 A07 WITH (NOLOCK)
INNER JOIN AT2006 A06 WITH (NOLOCK) ON A06.DivisionID = A07.DivisionID AND A06.VoucherID = A07.VoucherID
LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = A07.DivisionID AND O99.VoucherID = A07.VoucherID AND O99.TransactionID = A07.TransactionID AND O99.TableID = ''AT2007''
LEFT JOIN MT1001 M01 WITH (NOLOCK) ON M01.DivisionID = A07.DivisionID AND M01.VoucherID = A07.VoucherID
LEFT JOIN MT8899 M99 WITH (NOLOCK) ON M99.DivisionID = M01.DivisionID AND M99.VoucherID = M01.VoucherID AND M99.TransactionID = M01.TransactionID 
						AND ISNULL(O99.S01ID,'''') = ISNULL(M99.S01ID,'''')
						AND ISNULL(O99.S02ID,'''') = ISNULL(M99.S02ID,'''')
						AND ISNULL(O99.S03ID,'''') = ISNULL(M99.S03ID,'''')
						AND ISNULL(O99.S04ID,'''') = ISNULL(M99.S04ID,'''')
						AND ISNULL(O99.S05ID,'''') = ISNULL(M99.S05ID,'''')
						AND ISNULL(O99.S06ID,'''') = ISNULL(M99.S06ID,'''')
						AND ISNULL(O99.S07ID,'''') = ISNULL(M99.S07ID,'''')
						AND ISNULL(O99.S08ID,'''') = ISNULL(M99.S08ID,'''')
						AND ISNULL(O99.S09ID,'''') = ISNULL(M99.S09ID,'''')
						AND ISNULL(O99.S10ID,'''') = ISNULL(M99.S10ID,'''')
						AND ISNULL(O99.S11ID,'''') = ISNULL(M99.S11ID,'''')
						AND ISNULL(O99.S12ID,'''') = ISNULL(M99.S12ID,'''')
						AND ISNULL(O99.S13ID,'''') = ISNULL(M99.S13ID,'''')
						AND ISNULL(O99.S14ID,'''') = ISNULL(M99.S14ID,'''')
						AND ISNULL(O99.S15ID,'''') = ISNULL(M99.S15ID,'''')
						AND ISNULL(O99.S16ID,'''') = ISNULL(M99.S16ID,'''')
						AND ISNULL(O99.S17ID,'''') = ISNULL(M99.S17ID,'''')
						AND ISNULL(O99.S18ID,'''') = ISNULL(M99.S18ID,'''')
						AND ISNULL(O99.S19ID,'''') = ISNULL(M99.S19ID,'''')
						AND ISNULL(O99.S20ID,'''') = ISNULL(M99.S20ID,'''')
LEFT JOIN MT2005 M05 WITH (NOLOCK) ON M05.DivisionID = M01.DivisionID AND M05.VoucherID = M01.InheritVoucherID AND M05.TransactionID = M01.InheritTransactionID AND M01.InheritTableID = ''MT2004''
LEFT JOIN MT2002 M02 WITH (NOLOCK) ON M02.DivisionID = M05.DivisionID AND M02.PLanID = M05.PLanID
LEFT JOIN MT2001 WITH (NOLOCK) ON MT2001.DivisionID = M02.DivisionID AND MT2001.PlanID = M02.PlanID
LEFT JOIN OT2001 O01 WITH (NOLOCK) ON O01.DivisionID = MT2001.DivisionID AND O01.SOrderID = MT2001.SOderID
WHERE A07.DivisionID = '''+@DivisionID+'''
	AND A06.KindVoucherID IN (1,3,5)
	AND A06.TableID = ''MT0810''
	AND O01.InheritSOrderID BETWEEN N'''+@FromSOrderID+''' AND N'''+@ToSOrderID+'''
	AND ISNULL(M01.DivisionID,'''') <> ''''
GROUP BY A07.DivisionID, O01.SOrderID, A06.WareHouseID, A07.DebitAccountID, A07.CreditAccountID, A07.InventoryID, A07.ActualQuantity, A07.Ana05ID, 
O99.S01ID, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID	'

	--PRINT @sSQL
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00845')
		EXEC ('CREATE VIEW OV00845  ---TAO BOI OP0084
			AS '+@sSQL)
	ELSE
		EXEC( 'ALTER VIEW OV00845  ---TAO BOI OP0084
			AS '+@sSQL)
	


SET @sSQL = 'SELECT O41.DivisionID, O41.ObjectID, O41.SOrderID, 
	O41.TransactionID, O41.InventoryID, O41.OrderQuantity,
	O41.S01ID, O41.S02ID, O41.S03ID, O41.S04ID, O41.S05ID, O41.S06ID, O41.S07ID, O41.S08ID, O41.S09ID, O41.S10ID,
	O41.S11ID, O41.S12ID, O41.S13ID, O41.S14ID, O41.S15ID, O41.S16ID, O41.S17ID, O41.S18ID, O41.S19ID, O41.S20ID,
	O41.MaterialID, O41.MaterialUnitID, O41.MaterialTypeID, O41.MaterialQuantity, O41.RateDecimalApp AS RateDecimalAppSO, O41.QuantityUnit as QuantityUnitSO, O41.MaterialAmount,
	O41.DS01ID, O41.DS02ID, O41.DS03ID, O41.DS04ID, O41.DS05ID, O41.DS06ID, O41.DS07ID, O41.DS08ID, O41.DS09ID, O41.DS10ID,
	O41.DS11ID, O41.DS12ID, O41.DS13ID, O41.DS14ID, O41.DS15ID, O41.DS16ID, O41.DS17ID, O41.DS18ID, O41.DS19ID, O41.DS20ID,
	O44.ImWareHouseID, O44.ImDebitAccountID, O44.ImCreditAccountID, O44.ImActualQuantity, O44.ImAna05ID'
SET @sSQL1 = '
FROM OV00841 O41
LEFT JOIN OV00844 O44 ON O44.DivisionID = O41.DivisionID AND O44.SOrderID = O41.SOrderID AND O44.InventoryID = O41.MaterialID and O44.OTransactionID = O41.MTransactionID AND 	
						ISNULL(O41.DS01ID,'''') = ISNULL(O44.S01ID,'''') AND 
						ISNULL(O41.DS02ID,'''') = ISNULL(O44.S02ID,'''') AND 
						ISNULL(O41.DS03ID,'''') = ISNULL(O44.S03ID,'''') AND 
						ISNULL(O41.DS04ID,'''') = ISNULL(O44.S04ID,'''') AND 
						ISNULL(O41.DS05ID,'''') = ISNULL(O44.S05ID,'''') AND 
						ISNULL(O41.DS06ID,'''') = ISNULL(O44.S06ID,'''') AND 
						ISNULL(O41.DS07ID,'''') = ISNULL(O44.S07ID,'''') AND 
						ISNULL(O41.DS08ID,'''') = ISNULL(O44.S08ID,'''') AND 
						ISNULL(O41.DS09ID,'''') = ISNULL(O44.S09ID,'''') AND 
						ISNULL(O41.DS10ID,'''') = ISNULL(O44.S10ID,'''') AND 
						ISNULL(O41.DS11ID,'''') = ISNULL(O44.S11ID,'''') AND 
						ISNULL(O41.DS12ID,'''') = ISNULL(O44.S12ID,'''') AND 
						ISNULL(O41.DS13ID,'''') = ISNULL(O44.S13ID,'''') AND 
						ISNULL(O41.DS14ID,'''') = ISNULL(O44.S14ID,'''') AND 
						ISNULL(O41.DS15ID,'''') = ISNULL(O44.S15ID,'''') AND 
						ISNULL(O41.DS16ID,'''') = ISNULL(O44.S16ID,'''') AND 
						ISNULL(O41.DS17ID,'''') = ISNULL(O44.S17ID,'''') AND 
						ISNULL(O41.DS18ID,'''') = ISNULL(O44.S18ID,'''') AND 
						ISNULL(O41.DS19ID,'''') = ISNULL(O44.S19ID,'''') AND 
						ISNULL(O41.DS20ID,'''') = ISNULL(O44.S20ID,'''')	'

	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00846')
		EXEC ('CREATE VIEW OV00846  ---TAO BOI OP0084
			AS '+@sSQL + @sSQL1)
	ELSE
		EXEC( 'ALTER VIEW OV00846  ---TAO BOI OP0084
			AS '+@sSQL + @sSQL1)

SET @sSQL = '
	SELECT O42.DivisionID, O42.ObjectID, O42.SOrderID, O43.ExWareHouseID, O43.ExDebitAccountID, O43.ExCreditAccountID,
	O42.TransactionID, O42.InventoryID, O42.OrderQuantity, O45.ImQuantityProduct,
	O42.S01ID, O42.S02ID, O42.S03ID, O42.S04ID, O42.S05ID, O42.S06ID, O42.S07ID, O42.S08ID, O42.S09ID, O42.S10ID,
	O42.S11ID, O42.S12ID, O42.S13ID, O42.S14ID, O42.S15ID, O42.S16ID, O42.S17ID, O42.S18ID, O42.S19ID, O42.S20ID,
	O42.MaterialID, O42.MaterialUnitID, O42.MaterialTypeID, O42.MaterialQuantity, O42.MaterialAmount,
	O42.DS01ID, O42.DS02ID, O42.DS03ID, O42.DS04ID, O42.DS05ID, O42.DS06ID, O42.DS07ID, O42.DS08ID, O42.DS09ID, O42.DS10ID,
	O42.DS11ID, O42.DS12ID, O42.DS13ID, O42.DS14ID, O42.DS15ID, O42.DS16ID, O42.DS17ID, O42.DS18ID, O42.DS19ID, O42.DS20ID,
	O42.PlanQuantity, O42.QuantityUnit as QuantityUnitSX, O42.RateDecimalApp AS RateDecimalAppSX, O43.ExActualQuantity, O43.ExAna05ID,
	O42.InheritVoucherID, O42.InheritTransactionID
	'
SET @sSQL1 = '
FROM OV00842 O42
LEFT JOIN OV00843 O43 ON O43.DivisionID = O42.DivisionID AND O43.SOrderID = O42.SOrderID AND O43.InventoryID = O42.MaterialID AND O42.OTransactionID = O43.OTransactionID AND
ISNULL(O42.DS01ID,'''') = ISNULL(O43.S01ID,'''') AND 
						ISNULL(O42.DS02ID,'''') = ISNULL(O43.S02ID,'''') AND 
						ISNULL(O42.DS03ID,'''') = ISNULL(O43.S03ID,'''') AND 
						ISNULL(O42.DS04ID,'''') = ISNULL(O43.S04ID,'''') AND 
						ISNULL(O42.DS05ID,'''') = ISNULL(O43.S05ID,'''') AND 
						ISNULL(O42.DS06ID,'''') = ISNULL(O43.S06ID,'''') AND 
						ISNULL(O42.DS07ID,'''') = ISNULL(O43.S07ID,'''') AND 
						ISNULL(O42.DS08ID,'''') = ISNULL(O43.S08ID,'''') AND 
						ISNULL(O42.DS09ID,'''') = ISNULL(O43.S09ID,'''') AND 
						ISNULL(O42.DS10ID,'''') = ISNULL(O43.S10ID,'''') AND 
						ISNULL(O42.DS11ID,'''') = ISNULL(O43.S11ID,'''') AND 
						ISNULL(O42.DS12ID,'''') = ISNULL(O43.S12ID,'''') AND 
						ISNULL(O42.DS13ID,'''') = ISNULL(O43.S13ID,'''') AND 
						ISNULL(O42.DS14ID,'''') = ISNULL(O43.S14ID,'''') AND 
						ISNULL(O42.DS15ID,'''') = ISNULL(O43.S15ID,'''') AND 
						ISNULL(O42.DS16ID,'''') = ISNULL(O43.S16ID,'''') AND 
						ISNULL(O42.DS17ID,'''') = ISNULL(O43.S17ID,'''') AND 
						ISNULL(O42.DS18ID,'''') = ISNULL(O43.S18ID,'''') AND 
						ISNULL(O42.DS19ID,'''') = ISNULL(O43.S19ID,'''') AND 
						ISNULL(O42.DS20ID,'''') = ISNULL(O43.S20ID,'''')
LEFT JOIN OV00845 O45 ON O45.DivisionID = O42.DivisionID AND O45.SOrderID = O42.SOrderID AND O45.InventoryID = O42.InventoryID
						AND ISNULL(O42.S01ID,'''') = ISNULL(O45.S01ID,'''') 
						AND ISNULL(O42.S02ID,'''') = ISNULL(O45.S02ID,'''') 
						AND ISNULL(O42.S03ID,'''') = ISNULL(O45.S03ID,'''') 
						AND ISNULL(O42.S04ID,'''') = ISNULL(O45.S04ID,'''') 
						AND ISNULL(O42.S05ID,'''') = ISNULL(O45.S05ID,'''') 
						AND ISNULL(O42.S06ID,'''') = ISNULL(O45.S06ID,'''') 
						AND ISNULL(O42.S07ID,'''') = ISNULL(O45.S07ID,'''') 
						AND ISNULL(O42.S08ID,'''') = ISNULL(O45.S08ID,'''') 
						AND ISNULL(O42.S09ID,'''') = ISNULL(O45.S09ID,'''') 
						AND ISNULL(O42.S10ID,'''') = ISNULL(O45.S10ID,'''') 
						AND ISNULL(O42.S11ID,'''') = ISNULL(O45.S11ID,'''') 
						AND ISNULL(O42.S12ID,'''') = ISNULL(O45.S12ID,'''') 
						AND ISNULL(O42.S13ID,'''') = ISNULL(O45.S13ID,'''') 
						AND ISNULL(O42.S14ID,'''') = ISNULL(O45.S14ID,'''') 
						AND ISNULL(O42.S15ID,'''') = ISNULL(O45.S15ID,'''') 
						AND ISNULL(O42.S16ID,'''') = ISNULL(O45.S16ID,'''') 
						AND ISNULL(O42.S17ID,'''') = ISNULL(O45.S17ID,'''') 
						AND ISNULL(O42.S18ID,'''') = ISNULL(O45.S18ID,'''') 
						AND ISNULL(O42.S19ID,'''') = ISNULL(O45.S19ID,'''') 
						AND ISNULL(O42.S20ID,'''') = ISNULL(O45.S20ID,'''') '

	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV00847')
		EXEC ('CREATE VIEW OV00847 ---TAO BOI OP0084
			AS '+@sSQL + @sSQL1)
	ELSE
		EXEC( 'ALTER VIEW OV00847 ---TAO BOI OP0084
			AS '+@sSQL + @sSQL1)


	SET @sSQL = '
	SELECT O46.DivisionID, O46.ObjectID, AT1202.ObjectName, AT1202.Address, O46.SOrderID, O47.ExWareHouseID, O47.ExDebitAccountID, O47.ExCreditAccountID,
	O46.TransactionID, O46.InventoryID, AT1302.InventoryName, O46.OrderQuantity, O47.ImQuantityProduct, 
	O46.S01ID, O46.S02ID, O46.S03ID, O46.S04ID, O46.S05ID, O46.S06ID, O46.S07ID, O46.S08ID, O46.S09ID, O46.S10ID,
	O46.S11ID, O46.S12ID, O46.S13ID, O46.S14ID, O46.S15ID, O46.S16ID, O46.S17ID, O46.S18ID, O46.S19ID, O46.S20ID,
	O46.MaterialID, A32.InventoryName as MaterialName, O46.MaterialUnitID, O46.MaterialTypeID, O46.MaterialQuantity, O46.RateDecimalAppSO, O46.QuantityUnitSO, O46.MaterialAmount,
	O46.DS01ID, O46.DS02ID, O46.DS03ID, O46.DS04ID, O46.DS05ID, O46.DS06ID, O46.DS07ID, O46.DS08ID, O46.DS09ID, O46.DS10ID,
	O46.DS11ID, O46.DS12ID, O46.DS13ID, O46.DS14ID, O46.DS15ID, O46.DS16ID, O46.DS17ID, O46.DS18ID, O46.DS19ID, O46.DS20ID,
	O47.PlanQuantity, O47.QuantityUnitSX, O47.RateDecimalAppSX, O47.ExActualQuantity, O47.ExAna05ID,
	O46.ImWareHouseID, O46.ImDebitAccountID, O46.ImCreditAccountID, O46.ImActualQuantity, O46.ImAna05ID,
	A01.UserName as UserName01, A02.UserName as UserName02, A03.UserName as UserName03, A04.UserName as UserName04, A05.UserName as UserName05,
	A06.UserName as UserName06, A07.UserName as UserName07, A08.UserName as UserName08, A09.UserName as UserName09, A10.UserName as UserName10,
	A11.UserName as UserName11, A12.UserName as UserName12, A13.UserName as UserName13, A14.UserName as UserName14, A15.UserName as UserName15,
	A16.UserName as UserName16, A17.UserName as UserName17, A18.UserName as UserName18, A19.UserName as UserName19, A20.UserName as UserName20
	'
	SET @sSQL1 = '
	FROM OV00846 O46
	LEFT JOIN OV00847 O47 ON O46.DivisionID = O47.DivisionID AND O47.InheritVoucherID = O46.SOrderID AND O47.InheritTransactionID = O46.TransactionID AND
						ISNULL(O46.DS01ID,'''') = ISNULL(O47.DS01ID,'''') AND 
						ISNULL(O46.DS02ID,'''') = ISNULL(O47.DS02ID,'''') AND 
						ISNULL(O46.DS03ID,'''') = ISNULL(O47.DS03ID,'''') AND 
						ISNULL(O46.DS04ID,'''') = ISNULL(O47.DS04ID,'''') AND 
						ISNULL(O46.DS05ID,'''') = ISNULL(O47.DS05ID,'''') AND 
						ISNULL(O46.DS06ID,'''') = ISNULL(O47.DS06ID,'''') AND 
						ISNULL(O46.DS07ID,'''') = ISNULL(O47.DS07ID,'''') AND 
						ISNULL(O46.DS08ID,'''') = ISNULL(O47.DS08ID,'''') AND 
						ISNULL(O46.DS09ID,'''') = ISNULL(O47.DS09ID,'''') AND 
						ISNULL(O46.DS10ID,'''') = ISNULL(O47.DS10ID,'''') AND 
						ISNULL(O46.DS11ID,'''') = ISNULL(O47.DS11ID,'''') AND 
						ISNULL(O46.DS12ID,'''') = ISNULL(O47.DS12ID,'''') AND 
						ISNULL(O46.DS13ID,'''') = ISNULL(O47.DS13ID,'''') AND 
						ISNULL(O46.DS14ID,'''') = ISNULL(O47.DS14ID,'''') AND 
						ISNULL(O46.DS15ID,'''') = ISNULL(O47.DS15ID,'''') AND 
						ISNULL(O46.DS16ID,'''') = ISNULL(O47.DS16ID,'''') AND 
						ISNULL(O46.DS17ID,'''') = ISNULL(O47.DS17ID,'''') AND 
						ISNULL(O46.DS18ID,'''') = ISNULL(O47.DS18ID,'''') AND 
						ISNULL(O46.DS19ID,'''') = ISNULL(O47.DS19ID,'''') AND 
						ISNULL(O46.DS20ID,'''') = ISNULL(O47.DS20ID,'''')
						'
SET @sSQL2 = '
						AND ISNULL(O47.S01ID,'''') = ISNULL(O46.S01ID,'''') 
						AND ISNULL(O47.S02ID,'''') = ISNULL(O46.S02ID,'''') 
						AND ISNULL(O47.S03ID,'''') = ISNULL(O46.S03ID,'''') 
						AND ISNULL(O47.S04ID,'''') = ISNULL(O46.S04ID,'''') 
						AND ISNULL(O47.S05ID,'''') = ISNULL(O46.S05ID,'''') 
						AND ISNULL(O47.S06ID,'''') = ISNULL(O46.S06ID,'''') 
						AND ISNULL(O47.S07ID,'''') = ISNULL(O46.S07ID,'''') 
						AND ISNULL(O47.S08ID,'''') = ISNULL(O46.S08ID,'''') 
						AND ISNULL(O47.S09ID,'''') = ISNULL(O46.S09ID,'''') 
						AND ISNULL(O47.S10ID,'''') = ISNULL(O46.S10ID,'''') 
						AND ISNULL(O47.S11ID,'''') = ISNULL(O46.S11ID,'''') 
						AND ISNULL(O47.S12ID,'''') = ISNULL(O46.S12ID,'''') 
						AND ISNULL(O47.S13ID,'''') = ISNULL(O46.S13ID,'''') 
						AND ISNULL(O47.S14ID,'''') = ISNULL(O46.S14ID,'''') 
						AND ISNULL(O47.S15ID,'''') = ISNULL(O46.S15ID,'''') 
						AND ISNULL(O47.S16ID,'''') = ISNULL(O46.S16ID,'''') 
						AND ISNULL(O47.S17ID,'''') = ISNULL(O46.S17ID,'''') 
						AND ISNULL(O47.S18ID,'''') = ISNULL(O46.S18ID,'''') 
						AND ISNULL(O47.S19ID,'''') = ISNULL(O46.S19ID,'''') 
						AND ISNULL(O47.S20ID,'''') = ISNULL(O46.S20ID,'''')
	LEFT JOIN AT1302 WITH (NOLOCK) ON AT1302.DivisionID IN (''@@@'', O46.DivisionID) AND AT1302.InventoryID = O46.InventoryID
	LEFT JOIN AT1302 A32 WITH (NOLOCK) ON A32.DivisionID IN (''@@@'', O46.DivisionID) AND A32.InventoryID = O46.MaterialID
	LEFT JOIN AT1202 WITH (NOLOCK) ON AT1202.DivisionID IN (''' +@DivisionID+ ''', ''@@@'') AND AT1202.ObjectID = O46.ObjectID
	
	'
SET @sSQL3 = '
	LEFT JOIN AT0005 A01 WITH (NOLOCK) ON A01.TypeID like ''S01''
	LEFT JOIN AT0005 A02 WITH (NOLOCK) ON A02.TypeID like ''S02''
	LEFT JOIN AT0005 A03 WITH (NOLOCK) ON A03.TypeID like ''S03''
	LEFT JOIN AT0005 A04 WITH (NOLOCK) ON A04.TypeID like ''S04''
	LEFT JOIN AT0005 A05 WITH (NOLOCK) ON A05.TypeID like ''S05''
	LEFT JOIN AT0005 A06 WITH (NOLOCK) ON A06.TypeID like ''S06''
	LEFT JOIN AT0005 A07 WITH (NOLOCK) ON A07.TypeID like ''S07''
	LEFT JOIN AT0005 A08 WITH (NOLOCK) ON A08.TypeID like ''S08''
	LEFT JOIN AT0005 A09 WITH (NOLOCK) ON A09.TypeID like ''S09''
	LEFT JOIN AT0005 A10 WITH (NOLOCK) ON A10.TypeID like ''S10''
	LEFT JOIN AT0005 A11 WITH (NOLOCK) ON A11.TypeID like ''S11''
	LEFT JOIN AT0005 A12 WITH (NOLOCK) ON A12.TypeID like ''S12''
	LEFT JOIN AT0005 A13 WITH (NOLOCK) ON A13.TypeID like ''S13''
	LEFT JOIN AT0005 A14 WITH (NOLOCK) ON A14.TypeID like ''S14''
	LEFT JOIN AT0005 A15 WITH (NOLOCK) ON A15.TypeID like ''S15''
	LEFT JOIN AT0005 A16 WITH (NOLOCK) ON A16.TypeID like ''S16''
	LEFT JOIN AT0005 A17 WITH (NOLOCK) ON A17.TypeID like ''S17''
	LEFT JOIN AT0005 A18 WITH (NOLOCK) ON A18.TypeID like ''S18''
	LEFT JOIN AT0005 A19 WITH (NOLOCK) ON A19.TypeID like ''S19''
	LEFT JOIN AT0005 A20 WITH (NOLOCK) ON A20.TypeID like ''S20'''	
	--PRINT @sSQL
	--PRINT @sSQL1
	--PRINT @sSQL2
	IF NOT EXISTS (SELECT 1 FROM SYSOBJECTS WITH (NOLOCK) WHERE NAME ='OV0084')
		EXEC ('CREATE VIEW OV0084  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2+@sSQL3)
	ELSE
		EXEC( 'ALTER VIEW OV0084  ---TAO BOI OP0084
			AS '+@sSQL+@sSQL1+@sSQL2+@sSQL3)
	
END
GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO


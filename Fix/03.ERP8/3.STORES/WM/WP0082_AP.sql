IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[WP0082_AP]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[WP0082_AP]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



-- <Summary>
---- Báo cáo phân tích hàng tồn kho (CustomizeIndex = 54 - AN PHÁT)
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
---- 
-- <History>
---- Created by Tiểu Mai on 10/10/2016: lưu ý chỉ quan tâm đến quy cách S01ID
---- Modified by ... on ...
-- <Example>
-- Exec WP0082_AP 'PC' , '', 'TAGIO-0001', 'TAGL-00012', 'KBBI01', 'KVTU01', 1, 4, 2016, '2016-10-11 00:00:00.000'
    
CREATE PROCEDURE WP0082_AP
( 
		@DivisionID AS NVARCHAR(50),
		@FromInventoryID AS NVARCHAR(50),
		@ToInventoryID AS NVARCHAR(50),
		@FromWareHouseID AS NVARCHAR(50),
		@ToWareHouseID AS NVARCHAR(50),		
		@Date AS DATETIME
) 
AS 

DECLARE @sSQL1 AS NVARCHAR(4000),
		@sSQL2 AS NVARCHAR(4000),
		@sSQL3 AS NVARCHAR(4000),
		@sSQL4 AS NVARCHAR(4000),
		@sSQL51 AS NVARCHAR(4000),
		@sSQL52 AS NVARCHAR(4000),
		@sSQL61 AS NVARCHAR(4000),
		@sSQL62 AS NVARCHAR(4000),
		@sSQL71 AS NVARCHAR(4000),
		@sSQL72 AS NVARCHAR(4000),
		@sSQL81 AS NVARCHAR(4000),
		@sSQL82 AS NVARCHAR(4000),
		@sSQL91 AS NVARCHAR(4000),
		@sSQL92 AS NVARCHAR(4000),
		@sSQL10 AS NVARCHAR(4000),
		@sSQL11 AS NVARCHAR(4000),
		@sSQL12 AS NVARCHAR(4000),
		@sSQL13 AS NVARCHAR(4000),
		@sWhere AS NVARCHAR(4000),
		@sWhere1 AS NVARCHAR(4000)
				
--IF @IsTimes = 1
--	BEGIN
--		SET @TranMonth = Month(@Date)
--		SET @TranYear = Year(@Date)
--	END
--ELSE
--	BEGIN
--		SELECT @Date = EndDate FROM WT9999 WITH (NOLOCK) WHERE DivisionID = @DivisionID AND TranMonth = @TranMonth AND TranYear =@TranYear
--	END

SET @sWhere = ''
SET @sWhere1 = ''

SET @sWhere = @sWhere + N' AND CONVERT(NVARCHAR(10),O01.OrderDate,112) <= ' + CONVERT(NVARCHAR(10),@Date,112) + ' '

SET @sWhere1 = @sWhere1 + N' AND CONVERT(NVARCHAR(10),B.VoucherDate,112) <= ' + CONVERT(NVARCHAR(10),@Date,112) + ' '

		
-- 1. Lấy thông tin và số lượng tp ở đơn hàng bán
SET @sSQL1 = '
SELECT O01.DivisionID, O01.ObjectID, O02.InventoryID, O02.UnitID, SUM(Isnull(O02.OrderQuantity,0)) AS OrderQuantity, O99.S01ID, O99.S04ID
	--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID,
	--O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, 
	--O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
INTO #Order
FROM OT2002 O02 WITH (NOLOCK)
LEFT JOIN OT2001 O01 WITH (NOLOCK) ON O01.DivisionID = O02.DivisionID AND O01.SOrderID = O02.SOrderID
LEFT JOIN OT8899 O99 WITH (NOLOCK) ON O99.DivisionID = O02.DivisionID AND O99.TransactionID = O02.TransactionID AND O02.SOrderID = O99.VoucherID
WHERE O01.DivisionID = '''+@DivisionID+''' 
	AND O02.InventoryID BETWEEN '''+@FromInventoryID+''' AND '''+@ToInventoryID+'''
	AND O01.OrderType = 0 '+@sWhere+ '
GROUP BY  O01.DivisionID, O01.ObjectID, O02.InventoryID, O02.UnitID, O99.S01ID, O99.S04ID
	--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID,
	--O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
	--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, 
	--O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
'
	
-- 2. Lấy thông tin nhập kho
SET @sSQL2 = '
SELECT B.VoucherTypeID,	B.VoucherDate,	A.DivisionID,
		A.InventoryID,	A.UnitID, Ana05ID,
		SUM(Isnull(A.ActualQuantity,0)) AS Quantity, CAST(0 as Decimal(28,8)) AS ImportQuantity, S01ID
		--, S02ID, S03ID, S04ID, S05ID,
		--S06ID, S07ID, S08ID, S09ID, S10ID,
		--S11ID, S12ID, S13ID, S14ID, S15ID, 
		--S16ID, S17ID, S18ID, S19ID, S20ID 
INTO	#Import
FROM	(SELECT AT2017.DivisionID, AT2017.VoucherID, InventoryID, UnitID, ActualQuantity, ConvertedAmount, Ana05ID, O99.S01ID
			--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
			--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
    	 FROM AT2017 WITH (NOLOCK) 
    	 LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = AT2017.DivisionID AND O99.TransactionID = AT2017.TransactionID AND O99.VoucherID = AT2017.VoucherID
    	 Union All 
    	 SELECT AT2007.DivisionID, AT2007.VoucherID, InventoryID, UnitID, ActualQuantity, ConvertedAmount, Ana05ID, O99.S01ID
			--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
			--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID 
    	 FROM AT2007 WITH (NOLOCK)
    	 LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = AT2007.DivisionID AND O99.TransactionID = AT2007.TransactionID AND O99.VoucherID = AT2007.VoucherID) A
LEFT JOIN (SELECT DivisionID, VoucherTypeID, 1 As KindVoucherID, WareHouseID, VoucherID, VoucherDate, TranMonth, TranYear 
           FROM AT2016 WITH (NOLOCK) 
           Union All SELECT DivisionID, VoucherTypeID, KindVoucherID, WareHouseID, VoucherID, VoucherDate, TranMonth, TranYear 
			FROM AT2006 WITH (NOLOCK)) B 
	ON		B.VoucherID = A.VoucherID AND B.DivisionID = A.DivisionID
WHERE	B.KindVoucherID IN (1, 5,3,7,9)
		AND A.DivisionID = '''+@DivisionID+'''
		AND A.InventoryID BETWEEN '''+@FromInventoryID+''' AND '''+@ToInventoryID+''' 
		AND B.WareHouseID BETWEEN '''+@FromWareHouseID+''' AND '''+@ToWareHouseID+''' 
		 '+@sWhere1+'
GROUP BY A.DivisionID, B.VoucherTypeID, B.VoucherDate, A.InventoryID, A.UnitID, Ana05ID, S01ID
		--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
		--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
'

-- 3. Lấy thông tin xuất kho
SET @sSQL3 = '
SELECT B.VoucherTypeID,	B.VoucherDate, A.DivisionID, A.InventoryID, A.UnitID, A.Ana05ID,
		CAST(0 as Decimal(28,8)) AS Quantity, SUM(Isnull(A.ActualQuantity,0)) AS ExportQuantity, O99.S01ID
		--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
		--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
INTO	#Export
FROM	AT2007 A WITH (NOLOCK)
LEFT JOIN AT2006 B WITH (NOLOCK) ON B.VoucherID = A.VoucherID AND B.DivisionID = A.DivisionID
LEFT JOIN WT8899 O99 WITH (NOLOCK) ON O99.DivisionID = A.DivisionID AND O99.TransactionID = A.TransactionID AND O99.VoucherID = A.VoucherID
WHERE	B.KindVoucherID IN (2,3,4,6,8,10)
		AND A.DivisionID = '''+@DivisionID+''' 
		AND A.InventoryID BETWEEN '''+@FromInventoryID+''' AND '''+@ToInventoryID+''' 
		AND (Case when B.KindVoucherID=3 then B.WareHouseID2 else B.WareHouseID end) BETWEEN '''+@FromWareHouseID+''' AND '''+@ToWareHouseID+'''
		 '+@sWhere1+'
GROUP BY B.VoucherTypeID, B.VoucherDate, A.DivisionID, A.InventoryID, A.UnitID, A.Ana05ID, O99.S01ID
		--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
		--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
'

-- 4. Lấy thông tin tiến độ sản xuất
SET @sSQL4 = '
SELECT B.VoucherDate, M05.DivisionID, M05.InventoryID, M05.UnitID, SUM(Isnull(M05.ActualQuantity,0)) AS  ActualQuantity, O99.S01ID
		--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
		--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
INTO #Plan
FROM MT2005 M05 WITH (NOLOCK)
LEFT JOIN MT2004 B WITH (NOLOCK) ON B.DivisionID = M05.DivisionID AND B.VoucherID = M05.VoucherID
LEFT JOIN MT8899 O99 WITH (NOLOCK) ON O99.DivisionID = M05.DivisionID AND O99.TransactionID = M05.TransactionID AND O99.VoucherID = M05.VoucherID
WHERE B.DivisionID = '''+@DivisionID+''' 
		AND M05.InventoryID BETWEEN '''+@FromInventoryID+''' AND '''+@ToInventoryID+'''
		 '+@sWhere1+' 
GROUP BY B.VoucherDate, M05.DivisionID, M05.InventoryID, M05.UnitID, O99.S01ID
		--, O99.S02ID, O99.S03ID, O99.S04ID, O99.S05ID, O99.S06ID, O99.S07ID, O99.S08ID, O99.S09ID, O99.S10ID,
		--O99.S11ID, O99.S12ID, O99.S13ID, O99.S14ID, O99.S15ID, O99.S16ID, O99.S17ID, O99.S18ID, O99.S19ID, O99.S20ID
'

-- 5. Lấy dữ liệu báo cáo
SET @sSQL51 = '
SELECT O1.*, ImBCATQuantity1, ImBCATQuantity2, ImBGUIQuantity1, ImBGUIQuantity2, ImQuantity1, ImQuantity2,
	ExBCATQuantity1, ExBCATQuantity2, ExBMAYQuantity1, ExBMAYQuantity2, ExQuantity1, ExQuantity2, PlanQuantity1, PlanQuantity2
FROM #Order O1 

---- Nhap BCAT luy ke
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImBCATQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE Ana05ID  = ''BCAT''
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImBCAT1 
	ON O1.DivisionID  = ImBCAT1.DivisionID AND O1.InventoryID  = ImBCAT1.InventoryID AND O1.UnitID = ImBCAT1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImBCAT1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImBCAT1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImBCAT1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImBCAT1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImBCAT1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImBCAT1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImBCAT1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImBCAT1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImBCAT1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImBCAT1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImBCAT1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImBCAT1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImBCAT1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImBCAT1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImBCAT1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImBCAT1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImBCAT1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImBCAT1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImBCAT1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImBCAT1.S20ID, '''')
'
SET @sSQL52 = '
---- Nhap BCAT trong ngay
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImBCATQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE Ana05ID  = ''BCAT'' AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImBCAT2 
	ON O1.DivisionID  = ImBCAT2.DivisionID AND O1.InventoryID  = ImBCAT2.InventoryID AND O1.UnitID = ImBCAT2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImBCAT2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImBCAT2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImBCAT2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImBCAT2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImBCAT2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImBCAT2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImBCAT2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImBCAT2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImBCAT2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImBCAT2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImBCAT2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImBCAT2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImBCAT2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImBCAT2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImBCAT2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImBCAT2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImBCAT2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImBCAT2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImBCAT2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImBCAT2.S20ID, '''')
'
SET @sSQL61 = '
---- Nhập BGUI luy ke
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImBGUIQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE Ana05ID  = ''BGUI''
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImBGUI1 
	ON O1.DivisionID  = ImBGUI1.DivisionID AND O1.InventoryID  = ImBGUI1.InventoryID AND O1.UnitID = ImBGUI1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImBGUI1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImBGUI1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImBGUI1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImBGUI1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImBGUI1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImBGUI1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImBGUI1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImBGUI1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImBGUI1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImBGUI1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImBGUI1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImBGUI1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImBGUI1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImBGUI1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImBGUI1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImBGUI1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImBGUI1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImBGUI1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImBGUI1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImBGUI1.S20ID, '''')
'

SET @sSQL62 = '
---- Nhập BGUI trong ngay
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImBGUIQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE Ana05ID  = ''BGUI'' AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImBGUI2 
	ON O1.DivisionID  = ImBGUI2.DivisionID AND O1.InventoryID  = ImBGUI2.InventoryID AND O1.UnitID = ImBGUI2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImBGUI2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImBGUI2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImBGUI2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImBGUI2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImBGUI2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImBGUI2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImBGUI2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImBGUI2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImBGUI2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImBGUI2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImBGUI2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImBGUI2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImBGUI2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImBGUI2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImBGUI2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImBGUI2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImBGUI2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImBGUI2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImBGUI2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImBGUI2.S20ID, '''')
'
---- Nhập tp lũy kế
SET @sSQL72 = '
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE VoucherTypeID = ''NS'' AND Ana05ID NOT IN (''BGUI'', ''BMAY'', ''BCAT'')
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImPort1 
	ON O1.DivisionID  = ImPort1.DivisionID AND O1.InventoryID  = ImPort1.InventoryID AND O1.UnitID = ImPort1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImPort1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImPort1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImPort1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImPort1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImPort1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImPort1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImPort1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImPort1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImPort1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImPort1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImPort1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImPort1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImPort1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImPort1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImPort1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImPort1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImPort1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImPort1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImPort1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImPort1.S20ID, '''')
'
---- Nhập tp trong ngày
SET @sSQL71 = '
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ImportQuantity) AS ImQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Import WHERE VoucherTypeID = ''NS'' AND Ana05ID NOT IN (''BGUI'', ''BMAY'', ''BCAT'') AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ImPort2 
	ON O1.DivisionID  = ImPort2.DivisionID AND O1.InventoryID  = ImPort2.InventoryID AND O1.UnitID = ImPort2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ImPort2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ImPort2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ImPort2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ImPort2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ImPort2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ImPort2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ImPort2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ImPort2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ImPort2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ImPort2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ImPort2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ImPort2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ImPort2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ImPort2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ImPort2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ImPort2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ImPort2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ImPort2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ImPort2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ImPort2.S20ID, '''')
'

SET @sSQL81 = '
---- Xuất BCAT luy ke
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExBCATQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE Ana05ID  = ''BCAT''
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExBCAT1 
	ON O1.DivisionID  = ExBCAT1.DivisionID AND O1.InventoryID  = ExBCAT1.InventoryID AND O1.UnitID = ExBCAT1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExBCAT1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExBCAT1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExBCAT1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExBCAT1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExBCAT1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExBCAT1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExBCAT1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExBCAT1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExBCAT1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExBCAT1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExBCAT1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExBCAT1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExBCAT1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExBCAT1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExBCAT1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExBCAT1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExBCAT1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExBCAT1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExBCAT1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExBCAT1.S20ID, '''')
'
SET @sSQL82 = '
---- Xuất BCAT trong ngay
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExBCATQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE Ana05ID  = ''BCAT'' AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExBCAT2 
	ON O1.DivisionID  = ExBCAT2.DivisionID AND O1.InventoryID  = ExBCAT2.InventoryID AND O1.UnitID = ExBCAT2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExBCAT2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExBCAT2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExBCAT2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExBCAT2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExBCAT2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExBCAT2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExBCAT2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExBCAT2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExBCAT2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExBCAT2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExBCAT2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExBCAT2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExBCAT2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExBCAT2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExBCAT2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExBCAT2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExBCAT2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExBCAT2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExBCAT2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExBCAT2.S20ID, '''')
'
SET @sSQL91 = '
---- Xuất BMAY luy ke
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExBMAYQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE Ana05ID  = ''BMAY''
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExBMAY1 
	ON O1.DivisionID  = ExBMAY1.DivisionID AND O1.InventoryID  = ExBMAY1.InventoryID AND O1.UnitID = ExBMAY1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExBMAY1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExBMAY1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExBMAY1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExBMAY1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExBMAY1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExBMAY1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExBMAY1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExBMAY1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExBMAY1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExBMAY1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExBMAY1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExBMAY1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExBMAY1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExBMAY1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExBMAY1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExBMAY1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExBMAY1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExBMAY1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExBMAY1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExBMAY1.S20ID, '''')
'

SET @sSQL92 = '
---- Xuất BMAY trong ngay
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExBMAYQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE Ana05ID  = ''BMAY'' AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExBMAY2 
	ON O1.DivisionID  = ExBMAY2.DivisionID AND O1.InventoryID  = ExBMAY2.InventoryID AND O1.UnitID = ExBMAY2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExBMAY2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExBMAY2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExBMAY2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExBMAY2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExBMAY2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExBMAY2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExBMAY2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExBMAY2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExBMAY2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExBMAY2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExBMAY2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExBMAY2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExBMAY2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExBMAY2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExBMAY2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExBMAY2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExBMAY2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExBMAY2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExBMAY2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExBMAY2.S20ID, '''')
'
SET @sSQL10 = '
---- Xuất tp lũy kế
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE VoucherTypeID = ''XT'' AND Ana05ID NOT IN (''BGUI'', ''BMAY'', ''BCAT'')
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExPort1 
	ON O1.DivisionID  = ExPort1.DivisionID AND O1.InventoryID  = ExPort1.InventoryID AND O1.UnitID = ExPort1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExPort1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExPort1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExPort1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExPort1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExPort1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExPort1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExPort1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExPort1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExPort1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExPort1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExPort1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExPort1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExPort1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExPort1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExPort1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExPort1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExPort1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExPort1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExPort1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExPort1.S20ID, '''')
'
SET @sSQL11 = '
---- Xuất tp trong ngay
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ExportQuantity) AS ExQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Export WHERE VoucherTypeID = ''XT'' AND Ana05ID NOT IN (''BGUI'', ''BMAY'', ''BCAT'') AND CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
			) ExPort2 
	ON O1.DivisionID  = ExPort2.DivisionID AND O1.InventoryID  = ExPort2.InventoryID AND O1.UnitID = ExPort2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(ExPort2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(ExPort2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(ExPort2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(ExPort2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(ExPort2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(ExPort2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(ExPort2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(ExPort2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(ExPort2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(ExPort2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(ExPort2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(ExPort2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(ExPort2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(ExPort2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(ExPort2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(ExPort2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(ExPort2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(ExPort2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(ExPort2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(ExPort2.S20ID, '''')
'

SET @sSQL12 = '
---- Tiến độ sx lũy kế
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ActualQuantity) AS PlanQuantity1, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Plan 
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
) Plan1 
	ON O1.DivisionID  = Plan1.DivisionID AND O1.InventoryID  = Plan1.InventoryID AND O1.UnitID = Plan1.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(Plan1.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(Plan1.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(Plan1.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(Plan1.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(Plan1.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(Plan1.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(Plan1.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(Plan1.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(Plan1.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(Plan1.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(Plan1.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(Plan1.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(Plan1.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(Plan1.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(Plan1.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(Plan1.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(Plan1.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(Plan1.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(Plan1.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(Plan1.S20ID, '''')
'
SET @sSQL13 = '
---- Tiến độ sx trong ngày
LEFT JOIN (SELECT DivisionID, InventoryID, UnitID, SUM(ActualQuantity) AS PlanQuantity2, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID 
           FROM #Plan WHERE CONVERT(NVARCHAR(10),VoucherDate,112) = ' + CONVERT(NVARCHAR(10),@Date,112) + '
           GROUP BY DivisionID, InventoryID, UnitID, S01ID
			--, S02ID, S03ID, S04ID, S05ID, S06ID, S07ID, S08ID, S09ID, S10ID,
			--S11ID, S12ID, S13ID, S14ID, S15ID, S16ID, S17ID, S18ID, S19ID, S20ID
) Plan2 
	ON O1.DivisionID  = Plan2.DivisionID AND O1.InventoryID  = Plan2.InventoryID AND O1.UnitID = Plan2.UnitID 
		AND ISNULL(O1.S01ID,'''') = ISNULL(Plan2.S01ID, '''')
		--AND ISNULL(O1.S02ID,'''') = ISNULL(Plan2.S02ID, '''')
		--AND ISNULL(O1.S03ID,'''') = ISNULL(Plan2.S03ID, '''')
		--AND ISNULL(O1.S04ID,'''') = ISNULL(Plan2.S04ID, '''')
		--AND ISNULL(O1.S05ID,'''') = ISNULL(Plan2.S05ID, '''')
		--AND ISNULL(O1.S06ID,'''') = ISNULL(Plan2.S06ID, '''')
		--AND ISNULL(O1.S07ID,'''') = ISNULL(Plan2.S07ID, '''')
		--AND ISNULL(O1.S08ID,'''') = ISNULL(Plan2.S08ID, '''')
		--AND ISNULL(O1.S09ID,'''') = ISNULL(Plan2.S09ID, '''')
		--AND ISNULL(O1.S10ID,'''') = ISNULL(Plan2.S10ID, '''')
		--AND ISNULL(O1.S11ID,'''') = ISNULL(Plan2.S11ID, '''')
		--AND ISNULL(O1.S12ID,'''') = ISNULL(Plan2.S12ID, '''')
		--AND ISNULL(O1.S13ID,'''') = ISNULL(Plan2.S13ID, '''')
		--AND ISNULL(O1.S14ID,'''') = ISNULL(Plan2.S14ID, '''')
		--AND ISNULL(O1.S15ID,'''') = ISNULL(Plan2.S15ID, '''')
		--AND ISNULL(O1.S16ID,'''') = ISNULL(Plan2.S16ID, '''')
		--AND ISNULL(O1.S17ID,'''') = ISNULL(Plan2.S17ID, '''')
		--AND ISNULL(O1.S18ID,'''') = ISNULL(Plan2.S18ID, '''')
		--AND ISNULL(O1.S19ID,'''') = ISNULL(Plan2.S19ID, '''')
		--AND ISNULL(O1.S20ID,'''') = ISNULL(Plan2.S20ID, '''')
'
PRINT @sSQL1
PRINT @sSQL2
PRINT @sSQL3
PRINT @sSQL4
PRINT @sSQL51
PRINT @sSQL52
PRINT @sSQL61
PRINT @sSQL62
PRINT @sSQL71
PRINT @sSQL72
PRINT @sSQL81
PRINT @sSQL82
PRINT @sSQL91
PRINT @sSQL92
PRINT @sSQL10
PRINT @sSQL11
PRINT @sSQL12
PRINT @sSQL13
EXEC (@sSQL1+@sSQL2+@sSQL3+@sSQL4+@sSQL51+@sSQL52+@sSQL61+@sSQL62+@sSQL71+@sSQL72+@sSQL81+@sSQL82+@sSQL91+@sSQL92+@sSQL10+@sSQL11+@sSQL12+@sSQL13)


--PRINT @sSQL5
--PRINT @sSQL6
--PRINT @sSQL7
--PRINT @sSQL71
--PRINT @sSQL72
--PRINT @sSQL8


GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON

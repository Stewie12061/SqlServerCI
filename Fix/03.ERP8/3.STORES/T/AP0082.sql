IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[AP0082]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[AP0082]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



-- <Summary>
---- Load nguồn dropdown Mã phân tích
-- <History>
---- Create on 30/11/2015 by Phương Thảo
---- Modified on 25/10/2018 by Kim Thư - Bổ sung order by AnaTypeID asc , AnaID asc 
---- Modified on 27/12/2019 by Văn Minh - Back về lại where DivisionId cũ 
-- <Example>
/*
 exec AP0082 @DivisionID = 'GS'
 */

CREATE PROCEDURE [dbo].[AP0082] 	
	@DivisionID NVARCHAR(50)
AS

 SELECT *, 
		Convert(NVarchar(50),'') AS Ana01ID,
		Convert(NVarchar(50),'') AS ReAnaType01ID,
		Convert(NVarchar(50),'') AS Ana02ID,
		Convert(NVarchar(50),'') AS ReAnaType02ID,
		Convert(NVarchar(50),'') AS Ana03ID,
		Convert(NVarchar(50),'') AS ReAnaType03ID,
		Convert(NVarchar(50),'') AS Ana04ID,
		Convert(NVarchar(50),'') AS ReAnaType04ID,
		Convert(NVarchar(50),'') AS Ana05ID,
		Convert(NVarchar(50),'') AS ReAnaType05ID,
		Convert(NVarchar(50),'') AS Ana06ID,
		Convert(NVarchar(50),'') AS ReAnaType06ID,
		Convert(NVarchar(50),'') AS Ana07ID,
		Convert(NVarchar(50),'') AS ReAnaType07ID,
		Convert(NVarchar(50),'') AS Ana08ID,
		Convert(NVarchar(50),'') AS ReAnaType08ID,
		Convert(NVarchar(50),'') AS Ana09ID,
		Convert(NVarchar(50),'') AS ReAnaType09ID,
		Convert(NVarchar(50),'') AS Ana10ID,
		Convert(NVarchar(50),'') AS ReAnaType10ID
into #AT1011
FROM AT1011
WHERE Disabled = 0
AND DivisionID IN (@DivisionID,'@@@') -- AND AnaTypeID = 'A03'
ORDER BY AnaTypeID asc , AnaID asc 
	  	


Update T1
Set  T1.Ana01ID = CASE T2.ReTypeID WHEN  'A01' THEN T3.AnaID ELSE '' END,
	T1.Ana02ID = CASE T2.ReTypeID WHEN  'A02' THEN T3.AnaID ELSE '' END,
	T1.Ana03ID = CASE T2.ReTypeID WHEN  'A03' THEN T3.AnaID ELSE '' END,
	T1.Ana04ID = CASE T2.ReTypeID WHEN  'A04' THEN T3.AnaID ELSE '' END,
	T1.Ana05ID = CASE T2.ReTypeID WHEN  'A05' THEN T3.AnaID ELSE '' END,
	T1.Ana06ID = CASE T2.ReTypeID WHEN  'A06' THEN T3.AnaID ELSE '' END,	
	T1.Ana07ID = CASE T2.ReTypeID WHEN  'A07' THEN T3.AnaID ELSE '' END,
	T1.Ana08ID = CASE T2.ReTypeID WHEN  'A08' THEN T3.AnaID ELSE '' END,
	T1.Ana09ID = CASE T2.ReTypeID WHEN  'A09' THEN T3.AnaID ELSE '' END,
	T1.Ana10ID = CASE T2.ReTypeID WHEN  'A10' THEN T3.AnaID ELSE '' END,
	T1.ReAnaType01ID = CASE WHEN T2.ReTypeID = 'A01' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType02ID = CASE WHEN T2.ReTypeID = 'A02' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType03ID = CASE WHEN T2.ReTypeID = 'A03' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType04ID = CASE WHEN T2.ReTypeID = 'A04' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType05ID = CASE WHEN T2.ReTypeID = 'A05' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType06ID = CASE WHEN T2.ReTypeID = 'A06' THEN T2.ReTypeID ELSE '' END,	
	T1.ReAnaType07ID = CASE WHEN T2.ReTypeID = 'A07' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType08ID = CASE WHEN T2.ReTypeID = 'A08' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType09ID = CASE WHEN T2.ReTypeID = 'A09' THEN T2.ReTypeID ELSE '' END,
	T1.ReAnaType10ID = CASE WHEN T2.ReTypeID = 'A10' THEN T2.ReTypeID ELSE '' END
FROM #AT1011 T1
inner join AT0005 T2 on T1.AnaTypeID = T2.TypeID
inner join AT1011 T3 on T3.AnaTypeID = T2.ReTypeID AND T1.ReAnaID = T3.AnaID
	
declare @i int = 1, @N int

select @n = Count(1)
from AT0005
where isnull(ReTypeID,'') <> ''
	
While (@i <=@n)
begin
	Update T1
	set	T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,	
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,		
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana01ID = T2.AnaID and T1.ReAnaType01ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana01ID,'') <> ''


	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,	
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana02ID = T2.AnaID and T1.ReAnaType02ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana02ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID  WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana04ID = CASE T3.ReTypeID  WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID  WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,
		T1.Ana06ID = CASE T3.ReTypeID  WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,	
		T1.Ana07ID = CASE T3.ReTypeID  WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID  WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID  WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana03ID = T2.AnaID and T1.ReAnaType03ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana03ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,	
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID  END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID  END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID  END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID  END,
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID  END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID  END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID  END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID  END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID  END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana04ID = T2.AnaID and T1.ReAnaType04ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana04ID,'') <> ''


	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,	
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana05ID = T2.AnaID and T1.ReAnaType05ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana05ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,	
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,	
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana06ID = T2.AnaID and T1.ReAnaType06ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana06ID,'') <> ''


	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,	
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,	
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana07ID = T2.AnaID and T1.ReAnaType07ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana07ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,	
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,	
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana08ID = T2.AnaID and T1.ReAnaType08ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana08ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,	
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana10ID = CASE T3.ReTypeID WHEN  'A10' THEN T2.ReAnaID ELSE T1.Ana10ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,	
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType10ID = CASE WHEN T3.ReTypeID = 'A10' THEN T3.ReTypeID ELSE T1.ReAnaType10ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana09ID = T2.AnaID and T1.ReAnaType09ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana09ID,'') <> ''

	Update T1
	set	T1.Ana01ID = CASE T3.ReTypeID WHEN  'A01' THEN T2.ReAnaID ELSE T1.Ana01ID END,
		T1.Ana02ID = CASE T3.ReTypeID WHEN  'A02' THEN T2.ReAnaID ELSE T1.Ana02ID END,
		T1.Ana03ID = CASE T3.ReTypeID WHEN  'A03' THEN T2.ReAnaID ELSE T1.Ana03ID END,
		T1.Ana04ID = CASE T3.ReTypeID WHEN  'A04' THEN T2.ReAnaID ELSE T1.Ana04ID END,
		T1.Ana05ID = CASE T3.ReTypeID WHEN  'A05' THEN T2.ReAnaID ELSE T1.Ana05ID END,	
		T1.Ana06ID = CASE T3.ReTypeID WHEN  'A06' THEN T2.ReAnaID ELSE T1.Ana06ID END,
		T1.Ana07ID = CASE T3.ReTypeID WHEN  'A07' THEN T2.ReAnaID ELSE T1.Ana07ID END,
		T1.Ana08ID = CASE T3.ReTypeID WHEN  'A08' THEN T2.ReAnaID ELSE T1.Ana08ID END,
		T1.Ana09ID = CASE T3.ReTypeID WHEN  'A09' THEN T2.ReAnaID ELSE T1.Ana09ID END,
		T1.ReAnaType01ID = CASE WHEN T3.ReTypeID = 'A01' THEN T3.ReTypeID ELSE T1.ReAnaType01ID END,
		T1.ReAnaType02ID = CASE WHEN T3.ReTypeID = 'A02' THEN T3.ReTypeID ELSE T1.ReAnaType02ID END,
		T1.ReAnaType03ID = CASE WHEN T3.ReTypeID = 'A03' THEN T3.ReTypeID ELSE T1.ReAnaType03ID END,
		T1.ReAnaType04ID = CASE WHEN T3.ReTypeID = 'A04' THEN T3.ReTypeID ELSE T1.ReAnaType04ID END,
		T1.ReAnaType05ID = CASE WHEN T3.ReTypeID = 'A05' THEN T3.ReTypeID ELSE T1.ReAnaType05ID END,	
		T1.ReAnaType06ID = CASE WHEN T3.ReTypeID = 'A06' THEN T3.ReTypeID ELSE T1.ReAnaType06ID END,
		T1.ReAnaType07ID = CASE WHEN T3.ReTypeID = 'A07' THEN T3.ReTypeID ELSE T1.ReAnaType07ID END,
		T1.ReAnaType08ID = CASE WHEN T3.ReTypeID = 'A08' THEN T3.ReTypeID ELSE T1.ReAnaType08ID END,
		T1.ReAnaType09ID = CASE WHEN T3.ReTypeID = 'A09' THEN T3.ReTypeID ELSE T1.ReAnaType09ID END
	FROM #AT1011 T1
	inner join AT1011 T2 on T1.Ana10ID = T2.AnaID and T1.ReAnaType10ID = T2.AnaTypeID
	inner join AT0005 T3 on T2.AnaTypeID = T3.TypeID
	where	isnull(T1.Ana10ID,'') <> ''
	--select @i
	--select * from #AT1011
set @i = @i+1
end


select * from #AT1011
ORDER BY AnaTypeID asc , AnaID asc 





GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

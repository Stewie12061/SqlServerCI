IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[HP0048]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[HP0048]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

-- <Summary>
---- Đổ nguồn grid thông tin hệ số
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
---- 
-- <History>
---- 
---- Created On 28/11/2016 by Bảo Thy
---- Modified on 15/05/2018 by Bảo Anh: Sửa lỗi double dữ liệu khi có nhiều DivisionID
-- <Example>
---- EXEC HP0048 'MK', 'ASOFTADMIN', 'HT1403', '001339', 11, 2016
---- EXEC HP0048 'MK', 'ASOFTADMIN', 'HT1403', NULL, 11, 2016

CREATE PROCEDURE HP0048
( 
	@DivisionID AS NVARCHAR(50),
	@UserID AS NVARCHAR(50),
	@TableID AS NVARCHAR(50),
	@Value AS NVARCHAR(50),
	@TranMonth INT,
	@TranYear INT
) 
AS 
DECLARE @sSQL NVARCHAR(MAX) = '',
		@sSQL1 NVARCHAR(MAX) = '',
		@Unpivot NVARCHAR(MAX) = '',
		@Unpivot1 NVARCHAR(MAX) = '',
		@SubTableID NVARCHAR(50) = ''

IF ISNULL(@Value,'') = '' SET @TableID = 'HT0003'

IF @TableID = 'HT0003'
BEGIN
	SET @sSQL = '
	SELECT DivisionID,Caption, CoefficientID, ISNULL(ValueOfConstant,0) AS ValueOfConstant
	FROM HT0003 WITH (NOLOCK)
	WHERE DivisionID = '''+@DivisionID+'''
	AND ISNULL(IsUsed,0) = 1
	ORDER BY CONVERT(decimal(28,8),stuff(CoefficientID,1,1,'''')) 
	'
END

IF @TableID = 'HT0330'
BEGIN
	SET @SubTableID = 'HT0330_1'

	SET @sSQL = '
	(SELECT T1.DivisionID,ISNULL(T1.C01,0) AS C01, ISNULL(T1.C02,0) AS C02, ISNULL(T1.C03,0) AS C03, ISNULL(T1.C04,0) AS C04, ISNULL(T1.C05,0) AS C05, ISNULL(T1.C06,0) AS C06, 
	ISNULL(T1.C07,0) AS C07, ISNULL(T1.C08,0) AS C08, ISNULL(T1.C09,0) AS C09, ISNULL(T1.C10,0) AS C10, ISNULL(T1.C11,0) AS C11, ISNULL(T1.C12,0) AS C12, 
	ISNULL(T1.C13,0) AS C13, ISNULL(T1.C15,0) AS C15, ISNULL(T1.C16,0) AS C16, ISNULL(T1.C17,0) AS C17, ISNULL(T1.C14,0) AS C14, ISNULL(T1.C18,0) AS C18, 
	ISNULL(T1.C19,0) AS C19, ISNULL(T1.C20,0) AS C20, ISNULL(T1.C21,0) AS C21, ISNULL(T1.C22,0) As C22, ISNULL(T1.C23,0) AS C23, ISNULL(T1.C24,0) AS C24, 
	ISNULL(T1.C25,0) As C25, ISNULL(T2.C26,0) AS C26, ISNULL(T2.C27,0) AS C27, ISNULL(T2.C28,0) As C28, ISNULL(T2.C29,0) AS C29, ISNULL(T2.C30,0) AS C30, 
	ISNULL(T2.C31,0) AS C31, ISNULL(T2.C32,0) AS C32, ISNULL(T2.C33,0) AS C33, ISNULL(T2.C34,0) AS C34, ISNULL(T2.C35,0) AS C35, ISNULL(T2.C36,0) AS C36,
	ISNULL(T2.C37,0) As C37, ISNULL(T2.C38,0) AS C38, ISNULL(T2.C39,0) AS C39, ISNULL(T2.C40,0) As C40, ISNULL(T2.C41,0) AS C41, ISNULL(T2.C42,0) AS C42, 
	ISNULL(T2.C43,0) As C43, ISNULL(T2.C44,0) AS C44, ISNULL(T2.C45,0) AS C45, ISNULL(T2.C46,0) AS C46, ISNULL(T2.C47,0) AS C47, ISNULL(T2.C48,0) AS C48, 
	ISNULL(T2.C49,0) AS C49, ISNULL(T2.C50,0) AS C50, ISNULL(T2.C51,0) AS C51, ISNULL(T2.C52,0) As C52, ISNULL(T2.C53,0) AS C53, ISNULL(T2.C54,0) AS C54, 
	ISNULL(T2.C55,0) As C55, ISNULL(T2.C56,0) AS C56, ISNULL(T2.C57,0) AS C57, ISNULL(T2.C58,0) As C58, ISNULL(T2.C59,0) AS C59, ISNULL(T2.C60,0) AS C60, 
	ISNULL(T2.C61,0) AS C61, ISNULL(T2.C62,0) AS C62, ISNULL(T2.C63,0) AS C63, ISNULL(T2.C64,0) AS C64, ISNULL(T2.C65,0) AS C65, ISNULL(T2.C66,0) AS C66, 
	ISNULL(T2.C67,0) As C67, ISNULL(T2.C68,0) AS C68, ISNULL(T2.C69,0) AS C69, ISNULL(T2.C70,0) As C70, ISNULL(T2.C71,0) AS C71, ISNULL(T2.C72,0) AS C72, 
	ISNULL(T2.C73,0) As C73, ISNULL(T2.C74,0) AS C74, ISNULL(T2.C75,0) AS C75, ISNULL(T2.C76,0) AS C76, ISNULL(T2.C77,0) AS C77, ISNULL(T2.C78,0) AS C78, 
	ISNULL(T2.C79,0) AS C79, ISNULL(T2.C80,0) AS C80, ISNULL(T2.C81,0) AS C81, ISNULL(T2.C82,0) As C82, ISNULL(T2.C83,0) AS C83, ISNULL(T2.C84,0) AS C84, 
	ISNULL(T2.C85,0) As C85, ISNULL(T2.C86,0) AS C86, ISNULL(T2.C87,0) AS C87, ISNULL(T2.C88,0) As C88, ISNULL(T2.C89,0) AS C89, ISNULL(T2.C90,0) AS C90, 
	ISNULL(T2.C91,0) AS C91, ISNULL(T2.C92,0) AS C92, ISNULL(T2.C93,0) AS C93, ISNULL(T2.C94,0) AS C94, ISNULL(T2.C95,0) AS C95, ISNULL(T2.C96,0) AS C96,'
	SET @sSQL1 = '
	ISNULL(T2.C97,0) As C97, ISNULL(T2.C98,0) AS C98, ISNULL(T2.C99,0) AS C99, ISNULL(T2.C100,0) AS C100, ISNULL(T2.C101,0) AS C101, ISNULL(T2.C102,0) AS C102, 
	ISNULL(T2.C103,0) AS C103, ISNULL(T2.C104,0) AS C104, ISNULL(T2.C105,0) AS C105, ISNULL(T2.C106,0) AS C106, ISNULL(T2.C107,0) AS C107, ISNULL(T2.C108,0) AS C108, 
	ISNULL(T2.C109,0) AS C109, ISNULL(T2.C110,0) As C110, ISNULL(T2.C111,0) AS C111, ISNULL(T2.C112,0) AS C112, ISNULL(T2.C113,0) C113, ISNULL(T2.C114,0) AS C114, 
	ISNULL(T2.C115,0) As C115, ISNULL(T2.C116,0) AS C116, ISNULL(T2.C117,0) AS C117, ISNULL(T2.C118,0) AS C118, ISNULL(T2.C119,0) AS C119, ISNULL(T2.C120,0) AS C120, 
	ISNULL(T2.C121,0) AS C121, ISNULL(T2.C122,0) AS C122, ISNULL(T2.C123,0) AS C123, ISNULL(T2.C124,0) As C124, ISNULL(T2.C125,0) AS C125, ISNULL(T2.C126,0) AS C126, 
	ISNULL(T2.C127,0) AS C127, ISNULL(T2.C128,0) AS C128, ISNULL(T2.C129,0) As C129, ISNULL(T2.C130,0) AS C130, ISNULL(T2.C131,0) AS C131, ISNULL(T2.C132,0) AS C132, 
	ISNULL(T2.C133,0) AS C133, ISNULL(T2.C134,0) AS C134, ISNULL(T2.C135,0) AS C135, ISNULL(T2.C136,0) AS C136, ISNULL(T2.C137,0) AS C137, ISNULL(T2.C138,0) As C138, 
	ISNULL(T2.C139,0) AS C139, ISNULL(T2.C140,0) AS C140, ISNULL(T2.C141,0) C141, ISNULL(T2.C142,0) AS C142, ISNULL(T2.C143,0) As C143, ISNULL(T2.C144,0) AS C144, 
	ISNULL(T2.C145,0) AS C145, ISNULL(T2.C146,0) AS C146, ISNULL(T2.C147,0) AS C147, ISNULL(T2.C148,0) AS C148, ISNULL(T2.C149,0) AS C149, ISNULL(T2.C150,0) AS C150
	FROM '+@TableID+' T1 WITH (NOLOCK)
	LEFT JOIN '+@SubTableID+' T2 WITH (NOLOCK) ON T1.DivisionID = T2.DivisionID AND T1.APK = T2.APK
	WHERE T1.DivisionID = '''+@DivisionID+'''
	AND T1.APK = '''+@Value+''' ) UnP
	'
END

IF @TableID = 'HT1403'
BEGIN
	SET @SubTableID = 'HT1403_1'

	SET @sSQL = '
	(SELECT T1.DivisionID,ISNULL(T1.C01,0) AS C01, ISNULL(T1.C02,0) AS C02, ISNULL(T1.C03,0) AS C03, ISNULL(T1.C04,0) AS C04, ISNULL(T1.C05,0) AS C05, ISNULL(T1.C06,0) AS C06, 
	ISNULL(T1.C07,0) AS C07, ISNULL(T1.C08,0) AS C08, ISNULL(T1.C09,0) AS C09, ISNULL(T1.C10,0) AS C10, ISNULL(T1.C11,0) AS C11, ISNULL(T1.C12,0) AS C12, 
	ISNULL(T1.C13,0) AS C13, ISNULL(T1.C15,0) AS C15, ISNULL(T1.C16,0) AS C16, ISNULL(T1.C17,0) AS C17, ISNULL(T1.C14,0) AS C14, ISNULL(T1.C18,0) AS C18, 
	ISNULL(T1.C19,0) AS C19, ISNULL(T1.C20,0) AS C20, ISNULL(T1.C21,0) AS C21, ISNULL(T1.C22,0) As C22, ISNULL(T1.C23,0) AS C23, ISNULL(T1.C24,0) AS C24, 
	ISNULL(T1.C25,0) As C25, ISNULL(T2.C26,0) AS C26, ISNULL(T2.C27,0) AS C27, ISNULL(T2.C28,0) As C28, ISNULL(T2.C29,0) AS C29, ISNULL(T2.C30,0) AS C30, 
	ISNULL(T2.C31,0) AS C31, ISNULL(T2.C32,0) AS C32, ISNULL(T2.C33,0) AS C33, ISNULL(T2.C34,0) AS C34, ISNULL(T2.C35,0) AS C35, ISNULL(T2.C36,0) AS C36,
	ISNULL(T2.C37,0) As C37, ISNULL(T2.C38,0) AS C38, ISNULL(T2.C39,0) AS C39, ISNULL(T2.C40,0) As C40, ISNULL(T2.C41,0) AS C41, ISNULL(T2.C42,0) AS C42, 
	ISNULL(T2.C43,0) As C43, ISNULL(T2.C44,0) AS C44, ISNULL(T2.C45,0) AS C45, ISNULL(T2.C46,0) AS C46, ISNULL(T2.C47,0) AS C47, ISNULL(T2.C48,0) AS C48, 
	ISNULL(T2.C49,0) AS C49, ISNULL(T2.C50,0) AS C50, ISNULL(T2.C51,0) AS C51, ISNULL(T2.C52,0) As C52, ISNULL(T2.C53,0) AS C53, ISNULL(T2.C54,0) AS C54, 
	ISNULL(T2.C55,0) As C55, ISNULL(T2.C56,0) AS C56, ISNULL(T2.C57,0) AS C57, ISNULL(T2.C58,0) As C58, ISNULL(T2.C59,0) AS C59, ISNULL(T2.C60,0) AS C60, 
	ISNULL(T2.C61,0) AS C61, ISNULL(T2.C62,0) AS C62, ISNULL(T2.C63,0) AS C63, ISNULL(T2.C64,0) AS C64, ISNULL(T2.C65,0) AS C65, ISNULL(T2.C66,0) AS C66, 
	ISNULL(T2.C67,0) As C67, ISNULL(T2.C68,0) AS C68, ISNULL(T2.C69,0) AS C69, ISNULL(T2.C70,0) As C70, ISNULL(T2.C71,0) AS C71, ISNULL(T2.C72,0) AS C72, 
	ISNULL(T2.C73,0) As C73, ISNULL(T2.C74,0) AS C74, ISNULL(T2.C75,0) AS C75, ISNULL(T2.C76,0) AS C76, ISNULL(T2.C77,0) AS C77, ISNULL(T2.C78,0) AS C78, 
	ISNULL(T2.C79,0) AS C79, ISNULL(T2.C80,0) AS C80, ISNULL(T2.C81,0) AS C81, ISNULL(T2.C82,0) As C82, ISNULL(T2.C83,0) AS C83, ISNULL(T2.C84,0) AS C84, 
	ISNULL(T2.C85,0) As C85, ISNULL(T2.C86,0) AS C86, ISNULL(T2.C87,0) AS C87, ISNULL(T2.C88,0) As C88, ISNULL(T2.C89,0) AS C89, ISNULL(T2.C90,0) AS C90, 
	ISNULL(T2.C91,0) AS C91, ISNULL(T2.C92,0) AS C92, ISNULL(T2.C93,0) AS C93, ISNULL(T2.C94,0) AS C94, ISNULL(T2.C95,0) AS C95, ISNULL(T2.C96,0) AS C96,'
	SET @sSQL1 = '
	ISNULL(T2.C97,0) As C97, ISNULL(T2.C98,0) AS C98, ISNULL(T2.C99,0) AS C99, ISNULL(T2.C100,0) AS C100, ISNULL(T2.C101,0) AS C101, ISNULL(T2.C102,0) AS C102, 
	ISNULL(T2.C103,0) AS C103, ISNULL(T2.C104,0) AS C104, ISNULL(T2.C105,0) AS C105, ISNULL(T2.C106,0) AS C106, ISNULL(T2.C107,0) AS C107, ISNULL(T2.C108,0) AS C108, 
	ISNULL(T2.C109,0) AS C109, ISNULL(T2.C110,0) As C110, ISNULL(T2.C111,0) AS C111, ISNULL(T2.C112,0) AS C112, ISNULL(T2.C113,0) C113, ISNULL(T2.C114,0) AS C114, 
	ISNULL(T2.C115,0) As C115, ISNULL(T2.C116,0) AS C116, ISNULL(T2.C117,0) AS C117, ISNULL(T2.C118,0) AS C118, ISNULL(T2.C119,0) AS C119, ISNULL(T2.C120,0) AS C120, 
	ISNULL(T2.C121,0) AS C121, ISNULL(T2.C122,0) AS C122, ISNULL(T2.C123,0) AS C123, ISNULL(T2.C124,0) As C124, ISNULL(T2.C125,0) AS C125, ISNULL(T2.C126,0) AS C126, 
	ISNULL(T2.C127,0) AS C127, ISNULL(T2.C128,0) AS C128, ISNULL(T2.C129,0) As C129, ISNULL(T2.C130,0) AS C130, ISNULL(T2.C131,0) AS C131, ISNULL(T2.C132,0) AS C132, 
	ISNULL(T2.C133,0) AS C133, ISNULL(T2.C134,0) AS C134, ISNULL(T2.C135,0) AS C135, ISNULL(T2.C136,0) AS C136, ISNULL(T2.C137,0) AS C137, ISNULL(T2.C138,0) As C138, 
	ISNULL(T2.C139,0) AS C139, ISNULL(T2.C140,0) AS C140, ISNULL(T2.C141,0) C141, ISNULL(T2.C142,0) AS C142, ISNULL(T2.C143,0) As C143, ISNULL(T2.C144,0) AS C144, 
	ISNULL(T2.C145,0) AS C145, ISNULL(T2.C146,0) AS C146, ISNULL(T2.C147,0) AS C147, ISNULL(T2.C148,0) AS C148, ISNULL(T2.C149,0) AS C149, ISNULL(T2.C150,0) AS C150
	FROM '+@TableID+' T1 WITH (NOLOCK)
	LEFT JOIN '+@SubTableID+' T2 WITH (NOLOCK) ON T1.DivisionID = T2.DivisionID AND T1.EmployeeID = T2.EmployeeID
	WHERE T1.DivisionID = '''+@DivisionID+'''
	AND T1.EmployeeID = '''+@Value+''' ) UnP
	'
END

IF @TableID = 'HT2400'
BEGIN
	SET @SubTableID = 'HT2499'

	SET @sSQL = '
	(SELECT T1.DivisionID,ISNULL(T1.C01,0) AS C01, ISNULL(T1.C02,0) AS C02, ISNULL(T1.C03,0) AS C03, ISNULL(T1.C04,0) AS C04, ISNULL(T1.C05,0) AS C05, ISNULL(T1.C06,0) AS C06, 
	ISNULL(T1.C07,0) AS C07, ISNULL(T1.C08,0) AS C08, ISNULL(T1.C09,0) AS C09, ISNULL(T1.C10,0) AS C10, ISNULL(T1.C11,0) AS C11, ISNULL(T1.C12,0) AS C12, 
	ISNULL(T1.C13,0) AS C13, ISNULL(T1.C15,0) AS C15, ISNULL(T1.C16,0) AS C16, ISNULL(T1.C17,0) AS C17, ISNULL(T1.C14,0) AS C14, ISNULL(T1.C18,0) AS C18, 
	ISNULL(T1.C19,0) AS C19, ISNULL(T1.C20,0) AS C20, ISNULL(T1.C21,0) AS C21, ISNULL(T1.C22,0) As C22, ISNULL(T1.C23,0) AS C23, ISNULL(T1.C24,0) AS C24, 
	ISNULL(T1.C25,0) As C25, ISNULL(T2.C26,0) AS C26, ISNULL(T2.C27,0) AS C27, ISNULL(T2.C28,0) As C28, ISNULL(T2.C29,0) AS C29, ISNULL(T2.C30,0) AS C30, 
	ISNULL(T2.C31,0) AS C31, ISNULL(T2.C32,0) AS C32, ISNULL(T2.C33,0) AS C33, ISNULL(T2.C34,0) AS C34, ISNULL(T2.C35,0) AS C35, ISNULL(T2.C36,0) AS C36,
	ISNULL(T2.C37,0) As C37, ISNULL(T2.C38,0) AS C38, ISNULL(T2.C39,0) AS C39, ISNULL(T2.C40,0) As C40, ISNULL(T2.C41,0) AS C41, ISNULL(T2.C42,0) AS C42, 
	ISNULL(T2.C43,0) As C43, ISNULL(T2.C44,0) AS C44, ISNULL(T2.C45,0) AS C45, ISNULL(T2.C46,0) AS C46, ISNULL(T2.C47,0) AS C47, ISNULL(T2.C48,0) AS C48, 
	ISNULL(T2.C49,0) AS C49, ISNULL(T2.C50,0) AS C50, ISNULL(T2.C51,0) AS C51, ISNULL(T2.C52,0) As C52, ISNULL(T2.C53,0) AS C53, ISNULL(T2.C54,0) AS C54, 
	ISNULL(T2.C55,0) As C55, ISNULL(T2.C56,0) AS C56, ISNULL(T2.C57,0) AS C57, ISNULL(T2.C58,0) As C58, ISNULL(T2.C59,0) AS C59, ISNULL(T2.C60,0) AS C60, 
	ISNULL(T2.C61,0) AS C61, ISNULL(T2.C62,0) AS C62, ISNULL(T2.C63,0) AS C63, ISNULL(T2.C64,0) AS C64, ISNULL(T2.C65,0) AS C65, ISNULL(T2.C66,0) AS C66, 
	ISNULL(T2.C67,0) As C67, ISNULL(T2.C68,0) AS C68, ISNULL(T2.C69,0) AS C69, ISNULL(T2.C70,0) As C70, ISNULL(T2.C71,0) AS C71, ISNULL(T2.C72,0) AS C72, 
	ISNULL(T2.C73,0) As C73, ISNULL(T2.C74,0) AS C74, ISNULL(T2.C75,0) AS C75, ISNULL(T2.C76,0) AS C76, ISNULL(T2.C77,0) AS C77, ISNULL(T2.C78,0) AS C78, 
	ISNULL(T2.C79,0) AS C79, ISNULL(T2.C80,0) AS C80, ISNULL(T2.C81,0) AS C81, ISNULL(T2.C82,0) As C82, ISNULL(T2.C83,0) AS C83, ISNULL(T2.C84,0) AS C84, 
	ISNULL(T2.C85,0) As C85, ISNULL(T2.C86,0) AS C86, ISNULL(T2.C87,0) AS C87, ISNULL(T2.C88,0) As C88, ISNULL(T2.C89,0) AS C89, ISNULL(T2.C90,0) AS C90, 
	ISNULL(T2.C91,0) AS C91, ISNULL(T2.C92,0) AS C92, ISNULL(T2.C93,0) AS C93, ISNULL(T2.C94,0) AS C94, ISNULL(T2.C95,0) AS C95, ISNULL(T2.C96,0) AS C96,'
	SET @sSQL1 = '
	ISNULL(T2.C97,0) As C97, ISNULL(T2.C98,0) AS C98, ISNULL(T2.C99,0) AS C99, ISNULL(T2.C100,0) AS C100, ISNULL(T2.C101,0) AS C101, ISNULL(T2.C102,0) AS C102, 
	ISNULL(T2.C103,0) AS C103, ISNULL(T2.C104,0) AS C104, ISNULL(T2.C105,0) AS C105, ISNULL(T2.C106,0) AS C106, ISNULL(T2.C107,0) AS C107, ISNULL(T2.C108,0) AS C108, 
	ISNULL(T2.C109,0) AS C109, ISNULL(T2.C110,0) As C110, ISNULL(T2.C111,0) AS C111, ISNULL(T2.C112,0) AS C112, ISNULL(T2.C113,0) C113, ISNULL(T2.C114,0) AS C114, 
	ISNULL(T2.C115,0) As C115, ISNULL(T2.C116,0) AS C116, ISNULL(T2.C117,0) AS C117, ISNULL(T2.C118,0) AS C118, ISNULL(T2.C119,0) AS C119, ISNULL(T2.C120,0) AS C120, 
	ISNULL(T2.C121,0) AS C121, ISNULL(T2.C122,0) AS C122, ISNULL(T2.C123,0) AS C123, ISNULL(T2.C124,0) As C124, ISNULL(T2.C125,0) AS C125, ISNULL(T2.C126,0) AS C126, 
	ISNULL(T2.C127,0) AS C127, ISNULL(T2.C128,0) AS C128, ISNULL(T2.C129,0) As C129, ISNULL(T2.C130,0) AS C130, ISNULL(T2.C131,0) AS C131, ISNULL(T2.C132,0) AS C132, 
	ISNULL(T2.C133,0) AS C133, ISNULL(T2.C134,0) AS C134, ISNULL(T2.C135,0) AS C135, ISNULL(T2.C136,0) AS C136, ISNULL(T2.C137,0) AS C137, ISNULL(T2.C138,0) As C138, 
	ISNULL(T2.C139,0) AS C139, ISNULL(T2.C140,0) AS C140, ISNULL(T2.C141,0) C141, ISNULL(T2.C142,0) AS C142, ISNULL(T2.C143,0) As C143, ISNULL(T2.C144,0) AS C144, 
	ISNULL(T2.C145,0) AS C145, ISNULL(T2.C146,0) AS C146, ISNULL(T2.C147,0) AS C147, ISNULL(T2.C148,0) AS C148, ISNULL(T2.C149,0) AS C149, ISNULL(T2.C150,0) AS C150
	FROM '+@TableID+' T1 WITH (NOLOCK)
	LEFT JOIN '+@SubTableID+' T2 WITH (NOLOCK) ON T1.DivisionID = T2.DivisionID AND T1.EmpFileID = T2.EmpFileID AND T1.TranMonth = T2.TranMonth AND T1.TranYear = T2.TranYear
	WHERE T1.DivisionID = '''+@DivisionID+'''
	AND T1.EmpFileID = '''+@Value+'''
	AND T1.TranMonth = '+STR(@TranMonth)+'
	AND T1.TranYear = '+STR(@TranYear)+') UnP
	'
END

IF @TableID = 'HT2430'
BEGIN
	SET @SubTableID = 'HT2430_1'

	SET @sSQL = '
	(SELECT T1.DivisionID,ISNULL(T1.C01,0) AS C01, ISNULL(T1.C02,0) AS C02, ISNULL(T1.C03,0) AS C03, ISNULL(T1.C04,0) AS C04, ISNULL(T1.C05,0) AS C05, ISNULL(T1.C06,0) AS C06, 
	ISNULL(T1.C07,0) AS C07, ISNULL(T1.C08,0) AS C08, ISNULL(T1.C09,0) AS C09, ISNULL(T1.C10,0) AS C10, ISNULL(T1.C11,0) AS C11, ISNULL(T1.C12,0) AS C12, 
	ISNULL(T1.C13,0) AS C13, ISNULL(T1.C15,0) AS C15, ISNULL(T1.C16,0) AS C16, ISNULL(T1.C17,0) AS C17, ISNULL(T1.C14,0) AS C14, ISNULL(T1.C18,0) AS C18, 
	ISNULL(T1.C19,0) AS C19, ISNULL(T1.C20,0) AS C20, ISNULL(T1.C21,0) AS C21, ISNULL(T1.C22,0) As C22, ISNULL(T1.C23,0) AS C23, ISNULL(T1.C24,0) AS C24, 
	ISNULL(T1.C25,0) As C25, ISNULL(T2.C26,0) AS C26, ISNULL(T2.C27,0) AS C27, ISNULL(T2.C28,0) As C28, ISNULL(T2.C29,0) AS C29, ISNULL(T2.C30,0) AS C30, 
	ISNULL(T2.C31,0) AS C31, ISNULL(T2.C32,0) AS C32, ISNULL(T2.C33,0) AS C33, ISNULL(T2.C34,0) AS C34, ISNULL(T2.C35,0) AS C35, ISNULL(T2.C36,0) AS C36,
	ISNULL(T2.C37,0) As C37, ISNULL(T2.C38,0) AS C38, ISNULL(T2.C39,0) AS C39, ISNULL(T2.C40,0) As C40, ISNULL(T2.C41,0) AS C41, ISNULL(T2.C42,0) AS C42, 
	ISNULL(T2.C43,0) As C43, ISNULL(T2.C44,0) AS C44, ISNULL(T2.C45,0) AS C45, ISNULL(T2.C46,0) AS C46, ISNULL(T2.C47,0) AS C47, ISNULL(T2.C48,0) AS C48, 
	ISNULL(T2.C49,0) AS C49, ISNULL(T2.C50,0) AS C50, ISNULL(T2.C51,0) AS C51, ISNULL(T2.C52,0) As C52, ISNULL(T2.C53,0) AS C53, ISNULL(T2.C54,0) AS C54, 
	ISNULL(T2.C55,0) As C55, ISNULL(T2.C56,0) AS C56, ISNULL(T2.C57,0) AS C57, ISNULL(T2.C58,0) As C58, ISNULL(T2.C59,0) AS C59, ISNULL(T2.C60,0) AS C60, 
	ISNULL(T2.C61,0) AS C61, ISNULL(T2.C62,0) AS C62, ISNULL(T2.C63,0) AS C63, ISNULL(T2.C64,0) AS C64, ISNULL(T2.C65,0) AS C65, ISNULL(T2.C66,0) AS C66, 
	ISNULL(T2.C67,0) As C67, ISNULL(T2.C68,0) AS C68, ISNULL(T2.C69,0) AS C69, ISNULL(T2.C70,0) As C70, ISNULL(T2.C71,0) AS C71, ISNULL(T2.C72,0) AS C72, 
	ISNULL(T2.C73,0) As C73, ISNULL(T2.C74,0) AS C74, ISNULL(T2.C75,0) AS C75, ISNULL(T2.C76,0) AS C76, ISNULL(T2.C77,0) AS C77, ISNULL(T2.C78,0) AS C78, 
	ISNULL(T2.C79,0) AS C79, ISNULL(T2.C80,0) AS C80, ISNULL(T2.C81,0) AS C81, ISNULL(T2.C82,0) As C82, ISNULL(T2.C83,0) AS C83, ISNULL(T2.C84,0) AS C84, 
	ISNULL(T2.C85,0) As C85, ISNULL(T2.C86,0) AS C86, ISNULL(T2.C87,0) AS C87, ISNULL(T2.C88,0) As C88, ISNULL(T2.C89,0) AS C89, ISNULL(T2.C90,0) AS C90, 
	ISNULL(T2.C91,0) AS C91, ISNULL(T2.C92,0) AS C92, ISNULL(T2.C93,0) AS C93, ISNULL(T2.C94,0) AS C94, ISNULL(T2.C95,0) AS C95, ISNULL(T2.C96,0) AS C96,'
	SET @sSQL1 = '
	ISNULL(T2.C97,0) As C97, ISNULL(T2.C98,0) AS C98, ISNULL(T2.C99,0) AS C99, ISNULL(T2.C100,0) AS C100, ISNULL(T2.C101,0) AS C101, ISNULL(T2.C102,0) AS C102, 
	ISNULL(T2.C103,0) AS C103, ISNULL(T2.C104,0) AS C104, ISNULL(T2.C105,0) AS C105, ISNULL(T2.C106,0) AS C106, ISNULL(T2.C107,0) AS C107, ISNULL(T2.C108,0) AS C108, 
	ISNULL(T2.C109,0) AS C109, ISNULL(T2.C110,0) As C110, ISNULL(T2.C111,0) AS C111, ISNULL(T2.C112,0) AS C112, ISNULL(T2.C113,0) C113, ISNULL(T2.C114,0) AS C114, 
	ISNULL(T2.C115,0) As C115, ISNULL(T2.C116,0) AS C116, ISNULL(T2.C117,0) AS C117, ISNULL(T2.C118,0) AS C118, ISNULL(T2.C119,0) AS C119, ISNULL(T2.C120,0) AS C120, 
	ISNULL(T2.C121,0) AS C121, ISNULL(T2.C122,0) AS C122, ISNULL(T2.C123,0) AS C123, ISNULL(T2.C124,0) As C124, ISNULL(T2.C125,0) AS C125, ISNULL(T2.C126,0) AS C126, 
	ISNULL(T2.C127,0) AS C127, ISNULL(T2.C128,0) AS C128, ISNULL(T2.C129,0) As C129, ISNULL(T2.C130,0) AS C130, ISNULL(T2.C131,0) AS C131, ISNULL(T2.C132,0) AS C132, 
	ISNULL(T2.C133,0) AS C133, ISNULL(T2.C134,0) AS C134, ISNULL(T2.C135,0) AS C135, ISNULL(T2.C136,0) AS C136, ISNULL(T2.C137,0) AS C137, ISNULL(T2.C138,0) As C138, 
	ISNULL(T2.C139,0) AS C139, ISNULL(T2.C140,0) AS C140, ISNULL(T2.C141,0) C141, ISNULL(T2.C142,0) AS C142, ISNULL(T2.C143,0) As C143, ISNULL(T2.C144,0) AS C144, 
	ISNULL(T2.C145,0) AS C145, ISNULL(T2.C146,0) AS C146, ISNULL(T2.C147,0) AS C147, ISNULL(T2.C148,0) AS C148, ISNULL(T2.C149,0) AS C149, ISNULL(T2.C150,0) AS C150
	FROM '+@TableID+' T1 WITH (NOLOCK)
	LEFT JOIN '+@SubTableID+' T2 WITH (NOLOCK) ON T1.DivisionID = T2.DivisionID AND T1.ProjectID = T2.ProjectID AND T1.EmployeeID = T2.EmployeeID AND T1.TranMonth = T2.TranMonth AND T1.TranYear = T2.TranYear
	WHERE T1.DivisionID = '''+@DivisionID+'''
	AND T1.APK = '''+@Value+'''
	AND T1.TranMonth = '+STR(@TranMonth)+'
	AND T1.TranYear = '+STR(@TranYear)+' ) UnP
	'
END

IF ISNULL(@Value,'') <> ''
BEGIN
	SET @Unpivot = '
	SELECT DivisionID,CoefficientID, ValueOfConstant
	INTO #Temp
	FROM '

	SET @Unpivot1 = '
	UNPIVOT
	( ValueOfConstant FOR CoefficientID IN (
		C01, C02, C03, C04, C05, C06, C07, C08, C09, C10, C11, C12, C13, C15,
		C16, C17, C14, C18, C19, C20, C21,C22, C23, C24, C25, C26, C27, C28, C29, 
		C30, C31, C32, C33, C34, C35, C36, C37, C38, C39, C40, C41, C42, C43, C44, 
		C45, C46, C47, C48, C49, C50, C51, C52, C53, C54, C55, C56,C57, C58, C59, 
		C60, C61, C62, C63, C64, C65, C66, C67, C68, C69, C70, C71, C72, C73, C74, 
		C75, C76, C77, C78, C79, C80, C81, C82, C83, C84, C85, C86, C87, C88, C89, 
		C90, C91, C92, C93, C94, C95, C96, C97, C98, C99, C100, C101, C102, C103, C104, 
		C105, C106, C107, C108, C109, C110, C111, C112, C113, C114, C115, C116, C117, C118, 
		C119, C120, C121, C122, C123, C124, C125, C126, C127, C128, C129, C130, C131, C132, 
		C133, C134, C135, C136, C137, C138, C139, C140, C141, C142, C143, C144, C145, C146, C147, C148, C149, C150 ) 
	)AS UnPiv
	
	SELECT T2.Caption, T1.* FROM #Temp T1
	LEFT JOIN HT0003 T2 WITH (NOLOCK) ON T1.DivisionID = T2.DivisionID AND T1.CoefficientID = T2.CoefficientID
	WHERE ISNULL(T2.IsUsed,0) = 1
	ORDER BY CONVERT(decimal(28,8),stuff(T1.CoefficientID,1,1,'''')) 
	
	DROP TABLE #Temp
	'
	
	EXEC (@Unpivot+@sSQL+@sSQL1+@Unpivot1)
	
END
ELSE
	EXEC (@sSQL)

Print (@Unpivot)
Print (@sSQL)
Print (@sSQL1)
Print (@Unpivot1)

GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

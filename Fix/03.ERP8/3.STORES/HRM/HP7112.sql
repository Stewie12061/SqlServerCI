IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[HP7112]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[HP7112]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



-- HP7112
-- <Summary>
---- Stored -- Insert dữ liệu vào bảng chi tiết lương theo ngày -- HT5891
---- Created on 16/08/2017 Huỳnh Thử
-- <Param>

-- <Example>

CREATE PROCEDURE [dbo].[HP7112]
	@DivisionID AS NVARCHAR(50),
	@VoucherDate AS DATETIME,
	@TranMonth AS INT ,
	@TranYear AS INT 
AS

DECLARE @Cur_Ware AS CURSOR,
	@TransactionID nvarchar(50) ,
	@EmployeeID nvarchar(50) ,
	@DepartmentID nvarchar(50) ,
	@TeamID nvarchar(50) ,
	@SectionID nvarchar(50) ,
	@BaseSalary decimal(28, 8) ,
	@Income01_Cur decimal,
	@Income02_Cur decimal,
	@Income03_Cur decimal,
	@Income04_Cur decimal,
	@Income05_Cur decimal,
	@Income06_Cur decimal,
	@Income07_Cur decimal,
	@Income08_Cur decimal,
	@Income09_Cur decimal,
	@Income10_Cur decimal,
	@Income11_Cur decimal,
	@Income12_Cur decimal,
	@Income13_Cur decimal,
	@Income14_Cur decimal,
	@Income15_Cur decimal,
	@Income16_Cur decimal,
	@Income17_Cur decimal,
	@Income18_Cur decimal,
	@Income19_Cur decimal,
	@Income20_Cur decimal,
	@Income21_Cur decimal,
	@Income22_Cur decimal,
	@Income23_Cur decimal,
	@Income24_Cur decimal,
	@Income25_Cur decimal,
	@Income26_Cur decimal,
	@Income27_Cur decimal,
	@Income28_Cur decimal,
	@Income29_Cur decimal,
	@Income30_Cur decimal,
	@Income31_Cur decimal,
	@Income32_Cur decimal,
	@Income33_Cur decimal,
	@Income34_Cur decimal,
	@Income35_Cur decimal,
	@Income36_Cur decimal,
	@Income37_Cur decimal,
	@Income38_Cur decimal,
	@Income39_Cur decimal,
	@Income40_Cur decimal,
	@Income41_Cur decimal,
	@Income42_Cur decimal,
	@Income43_Cur decimal,
	@Income44_Cur decimal,
	@Income45_Cur decimal,
	@Income46_Cur decimal,
	@Income47_Cur decimal,
	@Income48_Cur decimal,
	@Income49_Cur decimal,
	@Income50_Cur decimal,
	@Income51_Cur decimal,
	@Income52_Cur decimal,
	@Income53_Cur decimal,
	@Income54_Cur decimal,
	@Income55_Cur decimal,
	@Income56_Cur decimal,
	@Income57_Cur decimal,
	@Income58_Cur decimal,
	@Income59_Cur decimal,
	@Income60_Cur decimal,
	@Income61_Cur decimal,
	@Income62_Cur decimal,
	@Income63_Cur decimal,
	@Income64_Cur decimal,
	@Income65_Cur decimal,
	@Income66_Cur decimal,
	@Income67_Cur decimal,
	@Income68_Cur decimal,
	@Income69_Cur decimal,
	@Income70_Cur decimal,
	@Income71_Cur decimal,
	@Income72_Cur decimal,
	@Income73_Cur decimal,
	@Income74_Cur decimal,
	@Income75_Cur decimal,
	@Income76_Cur decimal,
	@Income77_Cur decimal,
	@Income78_Cur decimal,
	@Income79_Cur decimal,
	@Income80_Cur decimal,
	@Income81_Cur decimal,
	@Income82_Cur decimal,
	@Income83_Cur decimal,
	@Income84_Cur decimal,
	@Income85_Cur decimal,
	@Income86_Cur decimal,
	@Income87_Cur decimal,
	@Income88_Cur decimal,
	@Income89_Cur decimal,
	@Income90_Cur decimal,
	@Income91_Cur decimal,
	@Income92_Cur decimal,
	@Income93_Cur decimal,
	@Income94_Cur decimal,
	@Income95_Cur decimal,
	@Income96_Cur decimal,
	@Income97_Cur decimal,
	@Income98_Cur decimal,
	@Income99_Cur decimal,
	@Income100_Cur decimal,
	@Income101_Cur decimal,
	@Income102_Cur decimal,
	@Income103_Cur decimal,
	@Income104_Cur decimal,
	@Income105_Cur decimal,
	@Income106_Cur decimal,
	@Income107_Cur decimal,
	@Income108_Cur decimal,
	@Income109_Cur decimal,
	@Income110_Cur decimal,
	@Income111_Cur decimal,
	@Income112_Cur decimal,
	@Income113_Cur decimal,
	@Income114_Cur decimal,
	@Income115_Cur decimal,
	@Income116_Cur decimal,
	@Income117_Cur decimal,
	@Income118_Cur decimal,
	@Income119_Cur decimal,
	@Income120_Cur decimal,
	@Income121_Cur decimal,
	@Income122_Cur decimal,
	@Income123_Cur decimal,
	@Income124_Cur decimal,
	@Income125_Cur decimal,
	@Income126_Cur decimal,
	@Income127_Cur decimal,
	@Income128_Cur decimal,
	@Income129_Cur decimal,
	@Income130_Cur decimal,
	@Income131_Cur decimal,
	@Income132_Cur decimal,
	@Income133_Cur decimal,
	@Income134_Cur decimal,
	@Income135_Cur decimal,
	@Income136_Cur decimal,
	@Income137_Cur decimal,
	@Income138_Cur decimal,
	@Income139_Cur decimal,
	@Income140_Cur decimal,
	@Income141_Cur decimal,
	@Income142_Cur decimal,
	@Income143_Cur decimal,
	@Income144_Cur decimal,
	@Income145_Cur decimal,
	@Income146_Cur decimal,
	@Income147_Cur decimal,
	@Income148_Cur decimal,
	@Income149_Cur decimal,
	@Income150_Cur DECIMAL,
	@Income01 decimal,
	@Income02 decimal,
	@Income03 decimal,
	@Income04 decimal,
	@Income05 decimal,
	@Income06 decimal,
	@Income07 decimal,
	@Income08 decimal,
	@Income09 decimal,
	@Income10 decimal,
	@Income11 decimal,
	@Income12 decimal,
	@Income13 decimal,
	@Income14 decimal,
	@Income15 decimal,
	@Income16 decimal,
	@Income17 decimal,
	@Income18 decimal,
	@Income19 decimal,
	@Income20 decimal,
	@Income21 decimal,
	@Income22 decimal,
	@Income23 decimal,
	@Income24 decimal,
	@Income25 decimal,
	@Income26 decimal,
	@Income27 decimal,
	@Income28 decimal,
	@Income29 decimal,
	@Income30 decimal,
	@Income31 decimal,
	@Income32 decimal,
	@Income33 decimal,
	@Income34 decimal,
	@Income35 decimal,
	@Income36 decimal,
	@Income37 decimal,
	@Income38 decimal,
	@Income39 decimal,
	@Income40 decimal,
	@Income41 decimal,
	@Income42 decimal,
	@Income43 decimal,
	@Income44 decimal,
	@Income45 decimal,
	@Income46 decimal,
	@Income47 decimal,
	@Income48 decimal,
	@Income49 decimal,
	@Income50 decimal,
	@Income51 decimal,
	@Income52 decimal,
	@Income53 decimal,
	@Income54 decimal,
	@Income55 decimal,
	@Income56 decimal,
	@Income57 decimal,
	@Income58 decimal,
	@Income59 decimal,
	@Income60 decimal,
	@Income61 decimal,
	@Income62 decimal,
	@Income63 decimal,
	@Income64 decimal,
	@Income65 decimal,
	@Income66 decimal,
	@Income67 decimal,
	@Income68 decimal,
	@Income69 decimal,
	@Income70 decimal,
	@Income71 decimal,
	@Income72 decimal,
	@Income73 decimal,
	@Income74 decimal,
	@Income75 decimal,
	@Income76 decimal,
	@Income77 decimal,
	@Income78 decimal,
	@Income79 decimal,
	@Income80 decimal,
	@Income81 decimal,
	@Income82 decimal,
	@Income83 decimal,
	@Income84 decimal,
	@Income85 decimal,
	@Income86 decimal,
	@Income87 decimal,
	@Income88 decimal,
	@Income89 decimal,
	@Income90 decimal,
	@Income91 decimal,
	@Income92 decimal,
	@Income93 decimal,
	@Income94 decimal,
	@Income95 decimal,
	@Income96 decimal,
	@Income97 decimal,
	@Income98 decimal,
	@Income99 decimal,
	@Income100 decimal,
	@Income101 decimal,
	@Income102 decimal,
	@Income103 decimal,
	@Income104 decimal,
	@Income105 decimal,
	@Income106 decimal,
	@Income107 decimal,
	@Income108 decimal,
	@Income109 decimal,
	@Income110 decimal,
	@Income111 decimal,
	@Income112 decimal,
	@Income113 decimal,
	@Income114 decimal,
	@Income115 decimal,
	@Income116 decimal,
	@Income117 decimal,
	@Income118 decimal,
	@Income119 decimal,
	@Income120 decimal,
	@Income121 decimal,
	@Income122 decimal,
	@Income123 decimal,
	@Income124 decimal,
	@Income125 decimal,
	@Income126 decimal,
	@Income127 decimal,
	@Income128 decimal,
	@Income129 decimal,
	@Income130 decimal,
	@Income131 decimal,
	@Income132 decimal,
	@Income133 decimal,
	@Income134 decimal,
	@Income135 decimal,
	@Income136 decimal,
	@Income137 decimal,
	@Income138 decimal,
	@Income139 decimal,
	@Income140 decimal,
	@Income141 decimal,
	@Income142 decimal,
	@Income143 decimal,
	@Income144 decimal,
	@Income145 decimal,
	@Income146 decimal,
	@Income147 decimal,
	@Income148 decimal,
	@Income149 decimal,
	@Income150 decimal
    

	

	SET @Cur_Ware = CURSOR SCROLL KEYSET FOR 
	SELECT 
	   HT3400.TransactionID,
       ht3400.EmployeeID,
       ht3400.DepartmentID,
       ht3400.TeamID,
       SectionID,
       ht2400.BaseSalary,
       Income01,
       Income02,
       Income03,
       Income04,
       Income05,
       Income06,
       Income07,
       Income08,
       Income09,
       Income10,
       Income11,
       Income12,
       Income13,
       Income14,
       Income15,
       Income16,
       Income17,
       Income18,
       Income19,
       Income20,
       Income21,
       Income22,
       Income23,
       Income24,
       Income25,
       Income26,
       Income27,
       Income28,
       Income29,
       Income30,
	   Income31,
	   Income32,
	   Income33,
	   Income34,
	   Income35,
	   Income36,
	   Income37,
	   Income38,
	   Income39,
	   Income40,
	   Income41,
	   Income42,
	   Income43,
	   Income44,
	   Income45,
	   Income46,
	   Income47,
	   Income48,
	   Income49,
	   Income50,
	   Income51,
	   Income52,
	   Income53,
	   Income54,
	   Income55,
	   Income56,
	   Income57,
	   Income58,
	   Income59,
	   Income60,
	   Income61,
	   Income62,
	   Income63,
	   Income64,
	   Income65,
	   Income66,
	   Income67,
	   Income68,
	   Income69,
	   Income70,
	   Income71,
	   Income72,
	   Income73,
	   Income74,
	   Income75,
	   Income76,
	   Income77,
	   Income78,
	   Income79,
	   Income80,
	   Income81,
	   Income82,
	   Income83,
	   Income84,
	   Income85,
	   Income86,
	   Income87,
	   Income88,
	   Income89,
	   Income90,
	   Income91,
	   Income92,
	   Income93,
	   Income94,
	   Income95,
	   Income96,
	   Income97,
	   Income98,
	   Income99,
	   Income100,
	   Income101,
	   Income102,
	   Income103,
	   Income104,
	   Income105,
	   Income106,
	   Income107,
	   Income108,
	   Income109,
	   Income110,
	   Income111,
	   Income112,
	   Income113,
	   Income114,
	   Income115,
	   Income116,
	   Income117,
	   Income118,
	   Income119,
	   Income120,
	   Income121,
	   Income122,
	   Income123,
	   Income124,
	   Income125,
	   Income126,
	   Income127,
	   Income128,
	   Income129,
	   Income130,
	   Income131,
	   Income132,
	   Income133,
	   Income134,
	   Income135,
	   Income136,
	   Income137,
	   Income138,
	   Income139,
	   Income140,
	   Income141,
	   Income142,
	   Income143,
	   Income144,
	   Income145,
	   Income146,
	   Income147,
	   Income148,
	   Income149,
	   Income150
       FROM dbo.HT3400
	   LEFT JOIN ht2400 ON HT2400.DivisionID = HT3400.DivisionID AND HT2400.EmployeeID = HT3400.EmployeeID AND HT2400.TranMonth = HT3400.TranMonth AND HT2400.TranYear = HT3400.TranYear
	   LEFT JOIN HT3499 ON HT3499.TransactionID = HT3400.TransactionID
	   WHERE HT3400.TranMonth = @TranMonth AND HT3400.TranYear = @TranYear
	   
	   OPEN @Cur_Ware
	   FETCH NEXT FROM @Cur_Ware INTO 
	   @TransactionID,
	   @EmployeeID,
	   @DepartmentID,
	   @TeamID,
	   @SectionID,
	   @BaseSalary,
	   @Income01_Cur,
	   @Income02_Cur,
	   @Income03_Cur,
	   @Income04_Cur,
	   @Income05_Cur,
	   @Income06_Cur,
	   @Income07_Cur,
	   @Income08_Cur,
	   @Income09_Cur,
	   @Income10_Cur,
	   @Income11_Cur,
	   @Income12_Cur,
	   @Income13_Cur,
	   @Income14_Cur,
	   @Income15_Cur,
	   @Income16_Cur,
	   @Income17_Cur,
	   @Income18_Cur,
	   @Income19_Cur,
	   @Income20_Cur,
	   @Income21_Cur,
	   @Income22_Cur,
	   @Income23_Cur,
	   @Income24_Cur,
	   @Income25_Cur,
	   @Income26_Cur,
	   @Income27_Cur,
	   @Income28_Cur,
	   @Income29_Cur,
	   @Income30_Cur,
	   @Income31_Cur,
	   @Income32_Cur,
	   @Income33_Cur,
	   @Income34_Cur,
	   @Income35_Cur,
	   @Income36_Cur,
	   @Income37_Cur,
	   @Income38_Cur,
	   @Income39_Cur,
	   @Income40_Cur,
	   @Income41_Cur,
	   @Income42_Cur,
	   @Income43_Cur,
	   @Income44_Cur,
	   @Income45_Cur,
	   @Income46_Cur,
	   @Income47_Cur,
	   @Income48_Cur,
	   @Income49_Cur,
	   @Income50_Cur,
	   @Income51_Cur,
	   @Income52_Cur,
	   @Income53_Cur,
	   @Income54_Cur,
	   @Income55_Cur,
	   @Income56_Cur,
	   @Income57_Cur,
	   @Income58_Cur,
	   @Income59_Cur,
	   @Income60_Cur,
	   @Income61_Cur,
	   @Income62_Cur,
	   @Income63_Cur,
	   @Income64_Cur,
	   @Income65_Cur,
	   @Income66_Cur,
	   @Income67_Cur,
	   @Income68_Cur,
	   @Income69_Cur,
	   @Income70_Cur,
	   @Income71_Cur,
	   @Income72_Cur,
	   @Income73_Cur,
	   @Income74_Cur,
	   @Income75_Cur,
	   @Income76_Cur,
	   @Income77_Cur,
	   @Income78_Cur,
	   @Income79_Cur,
	   @Income80_Cur,
	   @Income81_Cur,
	   @Income82_Cur,
	   @Income83_Cur,
	   @Income84_Cur,
	   @Income85_Cur,
	   @Income86_Cur,
	   @Income87_Cur,
	   @Income88_Cur,
	   @Income89_Cur,
	   @Income90_Cur,
	   @Income91_Cur,
	   @Income92_Cur,
	   @Income93_Cur,
	   @Income94_Cur,
	   @Income95_Cur,
	   @Income96_Cur,
	   @Income97_Cur,
	   @Income98_Cur,
	   @Income99_Cur,
	   @Income100_Cur,
	   @Income101_Cur,
	   @Income102_Cur,
	   @Income103_Cur,
	   @Income104_Cur,
	   @Income105_Cur,
	   @Income106_Cur,
	   @Income107_Cur,
	   @Income108_Cur,
	   @Income109_Cur,
	   @Income110_Cur,
	   @Income111_Cur,
	   @Income112_Cur,
	   @Income113_Cur,
	   @Income114_Cur,
	   @Income115_Cur,
	   @Income116_Cur,
	   @Income117_Cur,
	   @Income118_Cur,
	   @Income119_Cur,
	   @Income120_Cur,
	   @Income121_Cur,
	   @Income122_Cur,
	   @Income123_Cur,
	   @Income124_Cur,
	   @Income125_Cur,
	   @Income126_Cur,
	   @Income127_Cur,
	   @Income128_Cur,
	   @Income129_Cur,
	   @Income130_Cur,
	   @Income131_Cur,
	   @Income132_Cur,
	   @Income133_Cur,
	   @Income134_Cur,
	   @Income135_Cur,
	   @Income136_Cur,
	   @Income137_Cur,
	   @Income138_Cur,
	   @Income139_Cur,
	   @Income140_Cur,
	   @Income141_Cur,
	   @Income142_Cur,
	   @Income143_Cur,
	   @Income144_Cur,
	   @Income145_Cur,
	   @Income146_Cur,
	   @Income147_Cur,
	   @Income148_Cur,
	   @Income149_Cur,
	   @Income150_Cur
		WHILE @@Fetch_Status = 0 
		BEGIN

		 -- Check tồn tại
		IF EXISTS ( SELECT TOP 1 1 FROM HT5891 WHERE DivisionID = @DivisionID --AND TranMonth = @TranMonth AND TranYear = @TranYear 
		AND EmployeeID = @EmployeeID AND VoucherDate = @VoucherDate )
		DELETE HT5891 WHERE DivisionID = @DivisionID --AND TranMonth = @TranMonth AND TranYear = @TranYear 
		AND EmployeeID = @EmployeeID AND VoucherDate = @VoucherDate 

		-- Từ VoucherDate trở về trước
		SELECT   
		@Income01 = ISNULL(SUM(Income01),0),
		@Income02 = ISNULL(SUM(Income02),0),
		@Income03 = ISNULL(SUM(Income03),0),
		@Income04 = ISNULL(SUM(Income04),0),
		@Income05 = ISNULL(SUM(Income05),0),
		@Income06 = ISNULL(SUM(Income06),0),
		@Income07 = ISNULL(SUM(Income07),0),
		@Income08 = ISNULL(SUM(Income08),0),
		@Income09 = ISNULL(SUM(Income09),0),
		@Income10 = ISNULL(SUM(Income10),0),
		@Income11 = ISNULL(SUM(Income11),0),
		@Income12 = ISNULL(SUM(Income12),0),
		@Income13 = ISNULL(SUM(Income13),0),
		@Income14 = ISNULL(SUM(Income14),0),
		@Income15 = ISNULL(SUM(Income15),0),
		@Income16 = ISNULL(SUM(Income16),0),
		@Income17 = ISNULL(SUM(Income17),0),
		@Income18 = ISNULL(SUM(Income18),0),
		@Income19 = ISNULL(SUM(Income19),0),
		@Income20 = ISNULL(SUM(Income20),0),
		@Income21 = ISNULL(SUM(Income21),0),
		@Income22 = ISNULL(SUM(Income22),0),
		@Income23 = ISNULL(SUM(Income23),0),
		@Income24 = ISNULL(SUM(Income24),0),
		@Income25 = ISNULL(SUM(Income25),0),
		@Income26 = ISNULL(SUM(Income26),0),
		@Income27 = ISNULL(SUM(Income27),0),
		@Income28 = ISNULL(SUM(Income28),0),
		@Income29 = ISNULL(SUM(Income29),0),
		@Income30 = ISNULL(SUM(Income30),0),
		@Income31 = ISNULL(SUM(Income31),0),
		@Income32 = ISNULL(SUM(Income32),0),
		@Income33 = ISNULL(SUM(Income33),0),
		@Income34 = ISNULL(SUM(Income34),0),
		@Income35 = ISNULL(SUM(Income35),0),
		@Income36 = ISNULL(SUM(Income36),0),
		@Income37 = ISNULL(SUM(Income37),0),
		@Income38 = ISNULL(SUM(Income38),0),
		@Income39 = ISNULL(SUM(Income39),0),
		@Income40 = ISNULL(SUM(Income40),0),
		@Income41 = ISNULL(SUM(Income41),0),
		@Income42 = ISNULL(SUM(Income42),0),
		@Income43 = ISNULL(SUM(Income43),0),
		@Income44 = ISNULL(SUM(Income44),0),
		@Income45 = ISNULL(SUM(Income45),0),
		@Income46 = ISNULL(SUM(Income46),0),
		@Income47 = ISNULL(SUM(Income47),0),
		@Income48 = ISNULL(SUM(Income48),0),
		@Income49 = ISNULL(SUM(Income49),0),
		@Income50 = ISNULL(SUM(Income50),0),
		@Income51 = ISNULL(SUM(Income51),0),
		@Income52 = ISNULL(SUM(Income52),0),
		@Income53 = ISNULL(SUM(Income53),0),
		@Income54 = ISNULL(SUM(Income54),0),
		@Income55 = ISNULL(SUM(Income55),0),
		@Income56 = ISNULL(SUM(Income56),0),
		@Income57 = ISNULL(SUM(Income57),0),
		@Income58 = ISNULL(SUM(Income58),0),
		@Income59 = ISNULL(SUM(Income59),0),
		@Income60 = ISNULL(SUM(Income60),0),
		@Income61 = ISNULL(SUM(Income61),0),
		@Income62 = ISNULL(SUM(Income62),0),
		@Income63 = ISNULL(SUM(Income63),0),
		@Income64 = ISNULL(SUM(Income64),0),
		@Income65 = ISNULL(SUM(Income65),0),
		@Income66 = ISNULL(SUM(Income66),0),
		@Income67 = ISNULL(SUM(Income67),0),
		@Income68 = ISNULL(SUM(Income68),0),
		@Income69 = ISNULL(SUM(Income69),0),
		@Income70 = ISNULL(SUM(Income70),0),
		@Income71 = ISNULL(SUM(Income71),0),
		@Income72 = ISNULL(SUM(Income72),0),
		@Income73 = ISNULL(SUM(Income73),0),
		@Income74 = ISNULL(SUM(Income74),0),
		@Income75 = ISNULL(SUM(Income75),0),
		@Income76 = ISNULL(SUM(Income76),0),
		@Income77 = ISNULL(SUM(Income77),0),
		@Income78 = ISNULL(SUM(Income78),0),
		@Income79 = ISNULL(SUM(Income79),0),
		@Income80 = ISNULL(SUM(Income80),0),
		@Income81 = ISNULL(SUM(Income81),0),
		@Income82 = ISNULL(SUM(Income82),0),
		@Income83 = ISNULL(SUM(Income83),0),
		@Income84 = ISNULL(SUM(Income84),0),
		@Income85 = ISNULL(SUM(Income85),0),
		@Income86 = ISNULL(SUM(Income86),0),
		@Income87 = ISNULL(SUM(Income87),0),
		@Income88 = ISNULL(SUM(Income88),0),
		@Income89 = ISNULL(SUM(Income89),0),
		@Income90 = ISNULL(SUM(Income90),0),
		@Income91 = ISNULL(SUM(Income91),0),
		@Income92 = ISNULL(SUM(Income92),0),
		@Income93 = ISNULL(SUM(Income93),0),
		@Income94 = ISNULL(SUM(Income94),0),
		@Income95 = ISNULL(SUM(Income95),0),
		@Income96 = ISNULL(SUM(Income96),0),
		@Income97 = ISNULL(SUM(Income97),0),
		@Income98 = ISNULL(SUM(Income98),0),
		@Income99 = ISNULL(SUM(Income99),0),
		@Income100 = ISNULL(SUM(Income100),0),
		@Income101 = ISNULL(SUM(Income101),0),
		@Income102 = ISNULL(SUM(Income102),0),
		@Income103 = ISNULL(SUM(Income103),0),
		@Income104 = ISNULL(SUM(Income104),0),
		@Income105 = ISNULL(SUM(Income105),0),
		@Income106 = ISNULL(SUM(Income106),0),
		@Income107 = ISNULL(SUM(Income107),0),
		@Income108 = ISNULL(SUM(Income108),0),
		@Income109 = ISNULL(SUM(Income109),0),
		@Income110 = ISNULL(SUM(Income110),0),
		@Income111 = ISNULL(SUM(Income111),0),
		@Income112 = ISNULL(SUM(Income112),0),
		@Income113 = ISNULL(SUM(Income113),0),
		@Income114 = ISNULL(SUM(Income114),0),
		@Income115 = ISNULL(SUM(Income115),0),
		@Income116 = ISNULL(SUM(Income116),0),
		@Income117 = ISNULL(SUM(Income117),0),
		@Income118 = ISNULL(SUM(Income118),0),
		@Income119 = ISNULL(SUM(Income119),0),
		@Income120 = ISNULL(SUM(Income120),0),
		@Income121 = ISNULL(SUM(Income121),0),
		@Income122 = ISNULL(SUM(Income122),0),
		@Income123 = ISNULL(SUM(Income123),0),
		@Income124 = ISNULL(SUM(Income124),0),
		@Income125 = ISNULL(SUM(Income125),0),
		@Income126 = ISNULL(SUM(Income126),0),
		@Income127 = ISNULL(SUM(Income127),0),
		@Income128 = ISNULL(SUM(Income128),0),
		@Income129 = ISNULL(SUM(Income129),0),
		@Income130 = ISNULL(SUM(Income130),0),
		@Income131 = ISNULL(SUM(Income131),0),
		@Income132 = ISNULL(SUM(Income132),0),
		@Income133 = ISNULL(SUM(Income133),0),
		@Income134 = ISNULL(SUM(Income134),0),
		@Income135 = ISNULL(SUM(Income135),0),
		@Income136 = ISNULL(SUM(Income136),0),
		@Income137 = ISNULL(SUM(Income137),0),
		@Income138 = ISNULL(SUM(Income138),0),
		@Income139 = ISNULL(SUM(Income139),0),
		@Income140 = ISNULL(SUM(Income140),0),
		@Income141 = ISNULL(SUM(Income141),0),
		@Income142 = ISNULL(SUM(Income142),0),
		@Income143 = ISNULL(SUM(Income143),0),
		@Income144 = ISNULL(SUM(Income144),0),
		@Income145 = ISNULL(SUM(Income145),0),
		@Income146 = ISNULL(SUM(Income146),0),
		@Income147 = ISNULL(SUM(Income147),0),
		@Income148 = ISNULL(SUM(Income148),0),
		@Income149 = ISNULL(SUM(Income149),0),
		@Income150 = ISNULL(SUM(Income150),0)
	   FROM HT5891 WHERE TranMonth = @TranMonth AND TranYear = @TranYear AND EmployeeID = @EmployeeID AND VoucherDate < @VoucherDate

	   
		-- Insert vào HT5891
		INSERT INTO HT5891 
		SELECT NEWID() AS APK, @DivisionID AS DivisionID, @TransactionID AS TransactionID,@VoucherDate AS VoucherDate,@EmployeeID AS EmployeeID,@TranMonth AS TranMonth,@TranYear AS TranYear,@DepartmentID AS DepartmentID,@TeamID AS TeamID,@SectionID AS SectionID,@BaseSalary AS BaseSalary
		-- Lương cơ bản (Income01) lấy lên không trừ theo các ngày
		,ISNULL(@Income01_Cur - 0, 0) AS Income01
		,ISNULL(@Income02_Cur - @Income02, 0) AS Income02
		,ISNULL(@Income03_Cur - @Income03, 0) AS Income03
		,ISNULL(@Income04_Cur - @Income04, 0) AS Income04
		,ISNULL(@Income05_Cur - @Income05, 0) AS Income05
		,ISNULL(@Income06_Cur - @Income06, 0) AS Income06
		,ISNULL(@Income07_Cur - @Income07, 0) AS Income07
		,ISNULL(@Income08_Cur - @Income08, 0) AS Income08
		,ISNULL(@Income09_Cur - @Income09, 0) AS Income09
		,ISNULL(@Income10_Cur - @Income10, 0) AS Income10
		,ISNULL(@Income11_Cur - @Income11, 0) AS Income11
		,ISNULL(@Income12_Cur - @Income12, 0) AS Income12
		,ISNULL(@Income13_Cur - @Income13, 0) AS Income13
		,ISNULL(@Income14_Cur - @Income14, 0) AS Income14
		,ISNULL(@Income15_Cur - @Income15, 0) AS Income15
		,ISNULL(@Income16_Cur - @Income16, 0) AS Income16
		,ISNULL(@Income17_Cur - @Income17, 0) AS Income17
		,ISNULL(@Income18_Cur - @Income18, 0) AS Income18
		,ISNULL(@Income19_Cur - 0, 0) AS Income19
		,ISNULL(@Income20_Cur - @Income20, 0) AS Income20
		,ISNULL(@Income21_Cur - 0, 0) AS Income21
		,ISNULL(@Income22_Cur - @Income22, 0) AS Income22
		,ISNULL(@Income23_Cur - @Income23, 0) AS Income23
		,ISNULL(@Income24_Cur - @Income24, 0) AS Income24
		,ISNULL(@Income25_Cur - @Income25, 0) AS Income25
		,ISNULL(@Income26_Cur - @Income26, 0) AS Income26
		,ISNULL(@Income27_Cur - @Income27, 0) AS Income27
		,ISNULL(@Income28_Cur - @Income28, 0) AS Income28
		,ISNULL(@Income29_Cur - @Income29, 0) AS Income29
		,ISNULL(@Income30_Cur - @Income30, 0) AS Income30
		,ISNULL(@Income31_Cur - @Income31, 0) AS Income31 
	    ,ISNULL(@Income32_Cur - @Income32, 0) AS Income32 
	    ,ISNULL(@Income33_Cur - @Income33, 0) AS Income33 
	    ,ISNULL(@Income34_Cur - @Income34, 0) AS Income34 
	    ,ISNULL(@Income35_Cur - @Income35, 0) AS Income35 
	    ,ISNULL(@Income36_Cur - @Income36, 0) AS Income36 
	    ,ISNULL(@Income37_Cur - @Income37, 0) AS Income37 
	    ,ISNULL(@Income38_Cur - @Income38, 0) AS Income38 
	    ,ISNULL(@Income39_Cur - @Income39, 0) AS Income39 
	    ,ISNULL(@Income40_Cur - @Income40, 0) AS Income40 
	    ,ISNULL(@Income41_Cur - @Income41, 0) AS Income41 
	    ,ISNULL(@Income42_Cur - @Income42, 0) AS Income42 
	    ,ISNULL(@Income43_Cur - @Income43, 0) AS Income43 
	    ,ISNULL(@Income44_Cur - @Income44, 0) AS Income44 
	    ,ISNULL(@Income45_Cur - @Income45, 0) AS Income45 
	    ,ISNULL(@Income46_Cur - @Income46, 0) AS Income46 
	    ,ISNULL(@Income47_Cur - @Income47, 0) AS Income47 
	    ,ISNULL(@Income48_Cur - @Income48, 0) AS Income48 
	    ,ISNULL(@Income49_Cur - @Income49, 0) AS Income49 
	    ,ISNULL(@Income50_Cur - @Income50, 0) AS Income50 
	    ,ISNULL(@Income51_Cur - @Income51, 0) AS Income51 
	    ,ISNULL(@Income52_Cur - @Income52, 0) AS Income52 
	    ,ISNULL(@Income53_Cur - @Income53, 0) AS Income53 
	    ,ISNULL(@Income54_Cur - @Income54, 0) AS Income54 
	    ,ISNULL(@Income55_Cur - @Income55, 0) AS Income55 
	    ,ISNULL(@Income56_Cur - @Income56, 0) AS Income56 
	    ,ISNULL(@Income57_Cur - @Income57, 0) AS Income57 
	    ,ISNULL(@Income58_Cur - @Income58, 0) AS Income58 
	    ,ISNULL(@Income59_Cur - @Income59, 0) AS Income59 
	    ,ISNULL(@Income60_Cur - @Income60, 0) AS Income60 
	    ,ISNULL(@Income61_Cur - @Income61, 0) AS Income61 
	    ,ISNULL(@Income62_Cur - @Income62, 0) AS Income62 
	    ,ISNULL(@Income63_Cur - @Income63, 0) AS Income63 
	    ,ISNULL(@Income64_Cur - @Income64, 0) AS Income64 
	    ,ISNULL(@Income65_Cur - @Income65, 0) AS Income65 
	    ,ISNULL(@Income66_Cur - @Income66, 0) AS Income66 
	    ,ISNULL(@Income67_Cur - @Income67, 0) AS Income67 
	    ,ISNULL(@Income68_Cur - @Income68, 0) AS Income68 
	    ,ISNULL(@Income69_Cur - @Income69, 0) AS Income69 
	    ,ISNULL(@Income70_Cur - @Income70, 0) AS Income70 
	    ,ISNULL(@Income71_Cur - @Income71, 0) AS Income71 
	    ,ISNULL(@Income72_Cur - @Income72, 0) AS Income72 
	    ,ISNULL(@Income73_Cur - @Income73, 0) AS Income73 
	    ,ISNULL(@Income74_Cur - @Income74, 0) AS Income74 
	    ,ISNULL(@Income75_Cur - @Income75, 0) AS Income75 
	    ,ISNULL(@Income76_Cur - @Income76, 0) AS Income76 
	    ,ISNULL(@Income77_Cur - @Income77, 0) AS Income77 
	    ,ISNULL(@Income78_Cur - @Income78, 0) AS Income78 
	    ,ISNULL(@Income79_Cur - @Income79, 0) AS Income79 
	    ,ISNULL(@Income80_Cur - @Income80, 0) AS Income80 
	    ,ISNULL(@Income81_Cur - @Income81, 0) AS Income81 
	    ,ISNULL(@Income82_Cur - @Income82, 0) AS Income82 
	    ,ISNULL(@Income83_Cur - @Income83, 0) AS Income83 
	    ,ISNULL(@Income84_Cur - @Income84, 0) AS Income84 
	    ,ISNULL(@Income85_Cur - @Income85, 0) AS Income85 
	    ,ISNULL(@Income86_Cur - @Income86, 0) AS Income86 
	    ,ISNULL(@Income87_Cur - @Income87, 0) AS Income87 
	    ,ISNULL(@Income88_Cur - @Income88, 0) AS Income88 
	    ,ISNULL(@Income89_Cur - @Income89, 0) AS Income89 
	    ,ISNULL(@Income90_Cur - @Income90, 0) AS Income90 
	    ,ISNULL(@Income91_Cur - @Income91, 0) AS Income91 
	    ,ISNULL(@Income92_Cur - @Income92, 0) AS Income92 
	    ,ISNULL(@Income93_Cur - @Income93, 0) AS Income93 
	    ,ISNULL(@Income94_Cur - @Income94, 0) AS Income94 
	    ,ISNULL(@Income95_Cur - @Income95, 0) AS Income95 
	    ,ISNULL(@Income96_Cur - @Income96, 0) AS Income96 
	    ,ISNULL(@Income97_Cur - @Income97, 0) AS Income97 
	    ,ISNULL(@Income98_Cur - @Income98, 0) AS Income98 
	    ,ISNULL(@Income99_Cur - @Income99, 0) AS Income99 
	    ,ISNULL(@Income100_Cur - @Income100, 0) AS Income100
	    ,ISNULL(@Income101_Cur - @Income101, 0) AS Income101
	    ,ISNULL(@Income102_Cur - @Income102, 0) AS Income102
	    ,ISNULL(@Income103_Cur - @Income103, 0) AS Income103
	    ,ISNULL(@Income104_Cur - @Income104, 0) AS Income104
	    ,ISNULL(@Income105_Cur - @Income105, 0) AS Income105
	    ,ISNULL(@Income106_Cur - @Income106, 0) AS Income106
	    ,ISNULL(@Income107_Cur - @Income107, 0) AS Income107
	    ,ISNULL(@Income108_Cur - @Income108, 0) AS Income108
	    ,ISNULL(@Income109_Cur - @Income109, 0) AS Income109
	    ,ISNULL(@Income110_Cur - @Income110, 0) AS Income110
	    ,ISNULL(@Income111_Cur - @Income111, 0) AS Income111
	    ,ISNULL(@Income112_Cur - @Income112, 0) AS Income112
	    ,ISNULL(@Income113_Cur - @Income113, 0) AS Income113
	    ,ISNULL(@Income114_Cur - @Income114, 0) AS Income114
	    ,ISNULL(@Income115_Cur - @Income115, 0) AS Income115
	    ,ISNULL(@Income116_Cur - @Income116, 0) AS Income116
	    ,ISNULL(@Income117_Cur - @Income117, 0) AS Income117
	    ,ISNULL(@Income118_Cur - @Income118, 0) AS Income118
	    ,ISNULL(@Income119_Cur - @Income119, 0) AS Income119
	    ,ISNULL(@Income120_Cur - @Income120, 0) AS Income120
	    ,ISNULL(@Income121_Cur - @Income121, 0) AS Income121
	    ,ISNULL(@Income122_Cur - @Income122, 0) AS Income122
	    ,ISNULL(@Income123_Cur - @Income123, 0) AS Income123
	    ,ISNULL(@Income124_Cur - @Income124, 0) AS Income124
	    ,ISNULL(@Income125_Cur - @Income125, 0) AS Income125
	    ,ISNULL(@Income126_Cur - @Income126, 0) AS Income126
	    ,ISNULL(@Income127_Cur - @Income127, 0) AS Income127
	    ,ISNULL(@Income128_Cur - @Income128, 0) AS Income128
	    ,ISNULL(@Income129_Cur - @Income129, 0) AS Income129
	    ,ISNULL(@Income130_Cur - @Income130, 0) AS Income130
	    ,ISNULL(@Income131_Cur - @Income131, 0) AS Income131
	    ,ISNULL(@Income132_Cur - @Income132, 0) AS Income132
	    ,ISNULL(@Income133_Cur - @Income133, 0) AS Income133
	    ,ISNULL(@Income134_Cur - @Income134, 0) AS Income134
	    ,ISNULL(@Income135_Cur - @Income135, 0) AS Income135
	    ,ISNULL(@Income136_Cur - @Income136, 0) AS Income136
	    ,ISNULL(@Income137_Cur - @Income137, 0) AS Income137
	    ,ISNULL(@Income138_Cur - @Income138, 0) AS Income138
	    ,ISNULL(@Income139_Cur - @Income139, 0) AS Income139
	    ,ISNULL(@Income140_Cur - @Income140, 0) AS Income140
	    ,ISNULL(@Income141_Cur - @Income141, 0) AS Income141
	    ,ISNULL(@Income142_Cur - @Income142, 0) AS Income142
	    ,ISNULL(@Income143_Cur - @Income143, 0) AS Income143
	    ,ISNULL(@Income144_Cur - @Income144, 0) AS Income144
	    ,ISNULL(@Income145_Cur - @Income145, 0) AS Income145
	    ,ISNULL(@Income146_Cur - @Income146, 0) AS Income146
	    ,ISNULL(@Income147_Cur - @Income147, 0) AS Income147
	    ,ISNULL(@Income148_Cur - @Income148, 0) AS Income148
	    ,ISNULL(@Income149_Cur - @Income149, 0) AS Income149
	    ,ISNULL(@Income150_Cur - @Income150, 0) AS Income150

		
		FETCH NEXT FROM @Cur_Ware INTO 
		  @TransactionID,
		  @EmployeeID,
		  @DepartmentID,
		  @TeamID,
		  @SectionID,
		  @BaseSalary,
		  @Income01_Cur,
		  @Income02_Cur,
		  @Income03_Cur,
		  @Income04_Cur,
		  @Income05_Cur,
		  @Income06_Cur,
		  @Income07_Cur,
		  @Income08_Cur,
		  @Income09_Cur,
		  @Income10_Cur,
		  @Income11_Cur,
		  @Income12_Cur,
		  @Income13_Cur,
		  @Income14_Cur,
		  @Income15_Cur,
		  @Income16_Cur,
		  @Income17_Cur,
		  @Income18_Cur,
		  @Income19_Cur,
		  @Income20_Cur,
		  @Income21_Cur,
		  @Income22_Cur,
		  @Income23_Cur,
		  @Income24_Cur,
		  @Income25_Cur,
		  @Income26_Cur,
		  @Income27_Cur,
		  @Income28_Cur,
		  @Income29_Cur,
		  @Income30_Cur,
	      @Income31_Cur,
	      @Income32_Cur,
	      @Income33_Cur,
	      @Income34_Cur,
	      @Income35_Cur,
	      @Income36_Cur,
	      @Income37_Cur,
	      @Income38_Cur,
	      @Income39_Cur,
	      @Income40_Cur,
	      @Income41_Cur,
	      @Income42_Cur,
	      @Income43_Cur,
	      @Income44_Cur,
	      @Income45_Cur,
	      @Income46_Cur,
	      @Income47_Cur,
	      @Income48_Cur,
	      @Income49_Cur,
	      @Income50_Cur,
	      @Income51_Cur,
	      @Income52_Cur,
	      @Income53_Cur,
	      @Income54_Cur,
	      @Income55_Cur,
	      @Income56_Cur,
	      @Income57_Cur,
	      @Income58_Cur,
	      @Income59_Cur,
	      @Income60_Cur,
	      @Income61_Cur,
	      @Income62_Cur,
	      @Income63_Cur,
	      @Income64_Cur,
	      @Income65_Cur,
	      @Income66_Cur,
	      @Income67_Cur,
	      @Income68_Cur,
	      @Income69_Cur,
	      @Income70_Cur,
	      @Income71_Cur,
	      @Income72_Cur,
	      @Income73_Cur,
	      @Income74_Cur,
	      @Income75_Cur,
	      @Income76_Cur,
	      @Income77_Cur,
	      @Income78_Cur,
	      @Income79_Cur,
	      @Income80_Cur,
	      @Income81_Cur,
	      @Income82_Cur,
	      @Income83_Cur,
	      @Income84_Cur,
	      @Income85_Cur,
	      @Income86_Cur,
	      @Income87_Cur,
	      @Income88_Cur,
	      @Income89_Cur,
	      @Income90_Cur,
	      @Income91_Cur,
	      @Income92_Cur,
	      @Income93_Cur,
	      @Income94_Cur,
	      @Income95_Cur,
	      @Income96_Cur,
	      @Income97_Cur,
	      @Income98_Cur,
	      @Income99_Cur,
	      @Income100_Cur,
	      @Income101_Cur,
	      @Income102_Cur,
	      @Income103_Cur,
	      @Income104_Cur,
	      @Income105_Cur,
	      @Income106_Cur,
	      @Income107_Cur,
	      @Income108_Cur,
	      @Income109_Cur,
	      @Income110_Cur,
	      @Income111_Cur,
	      @Income112_Cur,
	      @Income113_Cur,
	      @Income114_Cur,
	      @Income115_Cur,
	      @Income116_Cur,
	      @Income117_Cur,
	      @Income118_Cur,
	      @Income119_Cur,
	      @Income120_Cur,
	      @Income121_Cur,
	      @Income122_Cur,
	      @Income123_Cur,
	      @Income124_Cur,
	      @Income125_Cur,
	      @Income126_Cur,
	      @Income127_Cur,
	      @Income128_Cur,
	      @Income129_Cur,
	      @Income130_Cur,
	      @Income131_Cur,
	      @Income132_Cur,
	      @Income133_Cur,
	      @Income134_Cur,
	      @Income135_Cur,
	      @Income136_Cur,
	      @Income137_Cur,
	      @Income138_Cur,
	      @Income139_Cur,
	      @Income140_Cur,
	      @Income141_Cur,
	      @Income142_Cur,
	      @Income143_Cur,
	      @Income144_Cur,
	      @Income145_Cur,
	      @Income146_Cur,
	      @Income147_Cur,
	      @Income148_Cur,
	      @Income149_Cur,
	      @Income150_Cur

		END

	CLOSE @Cur_Ware


GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

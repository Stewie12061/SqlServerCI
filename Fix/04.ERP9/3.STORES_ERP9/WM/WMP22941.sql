IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[WMP22941]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[WMP22941]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






-- <Summary>
---- Load lưới 2: kế thừa xuất kho mã vạch (WMP22941)
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
----
-- <History>
----Created by: Hồng Thắm , Date: 15/12/2023
-- <Example>
---- 
/*-- <Example>
	exec WMP22941 @DivisionID=N'HVH',@UserID=N'ADMIN',@PageNumber=1,@PageSize=25,@LstVoucherNo=N'XKMV/0053/12/23'

----*/

CREATE PROCEDURE WMP22941
( 
	 @DivisionID VARCHAR(50),
	 @UserID VARCHAR(50),
	 @PageNumber INT,
	 @PageSize INT,
	 @LstVoucherNo VARCHAR(4000)---,  Danh sách VoucherNo check chọn ở lưới master
	 ---@APK VARCHAR(MAX)

)
AS 
DECLARE @sSQL NVARCHAR(MAX),
		@CustomerIndex INT,
		@ModelAnalyst VARCHAR(50)

SET @sSQL = N'
SELECT BT1002.VoucherNo , BT1002.InventoryID, AT1302.InventoryName, AT1302.UnitID, AT1304.UnitName
, BT1002.Quantity, AT1302.SalePrice01 AS UnitPrice, BT1002.SourceNo
,BT1002.S01ID ,BT1002.S02ID ,BT1002.S03ID ,BT1002.S04ID ,BT1002.S05ID ,BT1002.S06ID ,BT1002.S07ID ,BT1002.S08ID ,BT1002.S09ID ,BT1002.S10ID
,BT1002.S11ID ,BT1002.S12ID ,BT1002.S13ID ,BT1002.S14ID ,BT1002.S15ID ,BT1002.S16ID ,BT1002.S17ID ,BT1002.S18ID ,BT1002.S19ID ,BT1002.S20ID
, WT0096.DebitAccountID, (Select AT1005.AccountName FROM AT1005 WHERE WT0096.DebitAccountID = AT1005.AccountID) AS DebitAccountName
, WT0096.CreditAccountID, (Select AT1005.AccountName FROM AT1005 WHERE WT0096.CreditAccountID = AT1005.AccountID) AS CreditAccountName
, WT0096.Ana01ID, WT0096.Ana02ID, WT0096.Ana03ID, WT0096.Ana04ID, WT0096.Ana05ID
, WT0096.Ana06ID, WT0096.Ana07ID, WT0096.Ana08ID, WT0096.Ana09ID, WT0096.Ana10ID
, WT0096.DriverID, WT0096.CarID,BT1002.InheritVoucherNo as ReVoucherNo, WT0096.ConvertedUnitID
FROM BT1002 WITH (NOLOCK)  
LEFT JOIN AT1302 WITH (NOLOCK) ON AT1302.DivisionID IN (BT1002.DivisionID, ''@@@'') AND AT1302.InventoryID = BT1002.InventoryID 
LEFT JOIN AT1304 WITH (NOLOCK) ON AT1304.DivisionID IN (BT1002.DivisionID, ''@@@'') AND AT1302.UnitID = AT1304.UnitID 
LEFT JOIN WT0096 WITH (NOLOCK) ON WT0096.DivisionID IN (BT1002.DivisionID, ''@@@'') AND WT0096.VoucherID = BT1002.InheritVoucherID AND WT0096.InventoryID = BT1002.InventoryID

WHERE BT1002.DivisionID =  '''+@DivisionID+''' AND BT1002.VoucherNo IN ('''+@LstVoucherNo+''')
GROUP BY BT1002.VoucherNo , BT1002.InventoryID, AT1302.InventoryName, AT1302.UnitID, AT1304.UnitName
, BT1002.Quantity, AT1302.SalePrice01 , BT1002.SourceNo
,BT1002.S01ID ,BT1002.S02ID ,BT1002.S03ID ,BT1002.S04ID ,BT1002.S05ID ,BT1002.S06ID ,BT1002.S07ID ,BT1002.S08ID ,BT1002.S09ID ,BT1002.S10ID
,BT1002.S11ID ,BT1002.S12ID ,BT1002.S13ID ,BT1002.S14ID ,BT1002.S15ID ,BT1002.S16ID ,BT1002.S17ID ,BT1002.S18ID ,BT1002.S19ID ,BT1002.S20ID
, WT0096.DebitAccountID, WT0096.CreditAccountID
, WT0096.Ana01ID, WT0096.Ana02ID, WT0096.Ana03ID, WT0096.Ana04ID, WT0096.Ana05ID
, WT0096.Ana06ID, WT0096.Ana07ID, WT0096.Ana08ID, WT0096.Ana09ID, WT0096.Ana10ID
, WT0096.DriverID, WT0096.CarID,BT1002.InheritVoucherNo, WT0096.ConvertedUnitID'


---PRINT @sSQL
EXEC (@sSQL)






GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

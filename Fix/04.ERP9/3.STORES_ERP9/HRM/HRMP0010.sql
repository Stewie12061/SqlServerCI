IF EXISTS (SELECT TOP 1 1 FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'[DBO].[HRMP0010]') AND  OBJECTPROPERTY(ID, N'IsProcedure') = 1)			
DROP PROCEDURE [DBO].[HRMP0010]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


-- <Summary>
---- Load danh sách người nhận mail (module đào tạo)
-- <Param>
---- 
-- <Return>
---- 
-- <Reference>
---- 
-- <History>
----Created by Hải Long on 06/10/2017
---- Modified by on
-- <Example>
---- 
/*
   EXEC HRMP0010 @DivisionID = 'AS',@UserID = 'ASOFTADMIN',@FormID = 'HRMF2071',@DepartmentID = '%' 
*/
CREATE PROCEDURE [HRMP0010]
( 
	@DivisionID VARCHAR(50),
	@UserID NVARCHAR(50),
	@FormID NVARCHAR(50),
	@DepartmentID NVARCHAR(50) = '%'	
)
AS

IF @FormID = 'HRMF2071'
BEGIN
	SELECT AT1103.EmployeeID, AT1103.FullName AS EmployeeName, Email
	FROM HRMT0001 WITH (NOLOCK)
	INNER JOIN CIT1201 WITH (NOLOCK) ON CIT1201.DivisionID = HRMT0001.DivisionID AND CIT1201.VoucherTypeID = HRMT0001.VTTrainingPlanID
	INNER JOIN CIT1202 WITH (NOLOCK) ON CIT1202.DivisionID = CIT1201.DivisionID AND CIT1202.APKMaster = CIT1201.APK
	INNER JOIN AT1103 WITH (NOLOCK) ON AT1103.DivisionID = CIT1202.DivisionID AND AT1103.DutyID = CIT1202.DutyID
	WHERE HRMT0001.DivisionID = @DivisionID
	AND AT1103.DepartmentID LIKE @DepartmentID	
END
ELSE
IF @FormID = 'HRMF2081'
BEGIN
	SELECT AT1103.EmployeeID, AT1103.FullName AS EmployeeName, Email
	FROM HRMT0001 WITH (NOLOCK)
	INNER JOIN CIT1201 WITH (NOLOCK) ON CIT1201.DivisionID = HRMT0001.DivisionID AND CIT1201.VoucherTypeID = HRMT0001.VTTrainingRequestID
	INNER JOIN CIT1202 WITH (NOLOCK) ON CIT1202.DivisionID = CIT1201.DivisionID AND CIT1202.APKMaster = CIT1201.APK
	INNER JOIN AT1103 WITH (NOLOCK) ON AT1103.DivisionID = CIT1202.DivisionID AND AT1103.DutyID = CIT1202.DutyID
	WHERE HRMT0001.DivisionID = @DivisionID
	AND AT1103.DepartmentID LIKE @DepartmentID	
END
ELSE
IF @FormID = 'HRMF2101'	
BEGIN
	SELECT AT1103.EmployeeID, AT1103.FullName AS EmployeeName, Email
	FROM HRMT0001 WITH (NOLOCK)
	INNER JOIN CIT1201 WITH (NOLOCK) ON CIT1201.DivisionID = HRMT0001.DivisionID AND CIT1201.VoucherTypeID = HRMT0001.VTTrainingScheduleID
	INNER JOIN CIT1202 WITH (NOLOCK) ON CIT1202.DivisionID = CIT1201.DivisionID AND CIT1202.APKMaster = CIT1201.APK
	INNER JOIN AT1103 WITH (NOLOCK) ON AT1103.DivisionID = CIT1202.DivisionID AND AT1103.DutyID = CIT1202.DutyID
	WHERE HRMT0001.DivisionID = @DivisionID
	AND AT1103.DepartmentID LIKE @DepartmentID	
END

GO
SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
